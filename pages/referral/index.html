<style>
  /* Make all table headers sticky */
  #referralTable thead th {
    position: sticky !important;
    top: 0 !important;
    background: #f8fafc !important;
    z-index: 20 !important;
  }

  /* First column (company name) should be sticky both vertically and horizontally */
  #referralTable thead th:first-child {
    position: sticky !important;
    left: 0 !important;
    top: 0 !important;
    background: #f8fafc !important;
    z-index: 60 !important;
  }

  #referralTable .sticky-col {
    position: sticky;
    left: 0;
    background: white;
    z-index: 10;
  }

  #referralTable thead th.is-sorted {
    background: #eef2ff;
    color: #4338ca;
  }

  #referralTable .sticky-col-header.is-sorted {
    background: #eef2ff;
  }

  .referral-table-wrapper {
    overflow-x: auto;
    overflow-y: visible;
  }

  /* 選択行ハイライトを右端まで維持 */
  #referralTable tr.selected-row>td {
    background: #eef2ff !important;
  }

  #referralTable tr.selected-row>td.sticky-col {
    position: sticky;
    left: 0;
    background: #eef2ff !important;

    z-index: 60;
  }

  /* ===== Referral Section Shell - グレー背景 + 余白 ===== */
  .section-shell {
    box-shadow: none !important;
    background: #f6f8fa !important;
  }

  /* ===== Header Bar (統一スタイル) ===== */
  .referral-header-bar {
    background: linear-gradient(135deg, #0077c7 0%, #005a9e 100%);
    padding: 16px 32px;
    color: white;
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
  }

  .referral-header-bar h3 {
    font-size: 18px;
    font-weight: 600;
    margin: 0;
  }

  .referral-header-bar p {
    font-size: 13px;
    opacity: 0.85;
    margin: 4px 0 0 0;
  }

  /* ===== アクションボタン（フィルターバー用） ===== */
  .referral-action-btn {
    background: #0077c7;
    border: none;
    color: white;
    padding: 10px 20px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .referral-action-btn:hover {
    background: #005a9e;
  }

  .referral-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 16px;
    margin: 24px 0;
  }

  .referral-stat-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    border: 1px solid #e2e8f0;
    text-align: center;
    transition: all 0.2s;
  }

  .referral-stat-card:hover {
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    transform: translateY(-2px);
  }

  .referral-stat-value {
    font-size: 28px;
    font-weight: 700;
    color: #1e293b;
  }

  .referral-stat-label {
    font-size: 12px;
    color: #64748b;
    margin-top: 4px;
  }

  .referral-filter-bar {
    background: transparent;
    border-radius: 0;
    padding: 12px 0;
    display: flex;
    align-items: center;
    gap: 16px;
    flex-wrap: wrap;
    margin-bottom: 16px;
    border-bottom: 1px solid #e2e8f0;
  }

  .referral-filter-group {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .referral-filter-label {
    font-size: 12px;
    color: #64748b;
    font-weight: 500;
  }

  .referral-filter-input {
    height: 36px;
    padding: 0 12px;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    font-size: 13px;
    background: white;
    transition: all 0.2s;
  }

  .referral-filter-input:focus {
    outline: none;
    border-color: #0077c7;
    box-shadow: 0 0 0 3px rgba(0, 119, 199, 0.15);
  }

  .referral-filter-btn {
    height: 36px;
    padding: 0 16px;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.15s;
  }

  .referral-filter-btn-primary {
    background: #0077c7;
    color: white;
    border: none;
  }

  .referral-filter-btn-primary:hover {
    background: #005a9e;
  }

  .referral-filter-btn-secondary {
    background: white;
    color: #64748b;
    border: 1px solid #e2e8f0;
  }

  .referral-filter-btn-secondary:hover {
    background: #f1f5f9;
  }

  .referral-count-badge {
    background: #0077c7;
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
  }

  /* ===== SmartHR/HRMOS風 テーブルスタイル ===== */
  #referralTable {
    border-collapse: separate;
    border-spacing: 0;
    font-size: 13px;
  }

  #referralTable thead th {
    background: #0077c7 !important;
    color: white !important;
    font-weight: 600;
    font-size: 12px;
    padding: 12px 16px;
    text-align: left;
    border-bottom: none;
    white-space: nowrap;
  }

  #referralTable thead th:first-child {
    background: #005a9e !important;
    border-radius: 8px 0 0 0;
  }

  #referralTable thead th:last-child {
    border-radius: 0 8px 0 0;
  }

  #referralTable thead th.is-sorted {
    background: #005a9e !important;
    color: white !important;
  }

  #referralTable tbody tr {
    transition: background 0.15s;
  }

  #referralTable tbody tr:nth-child(even) {
    background: #f8fafc;
  }

  #referralTable tbody tr:hover {
    background: #e0f2fe !important;
  }

  #referralTable tbody td {
    padding: 12px 16px;
    border-bottom: 1px solid #e2e8f0;
    color: #334155;
  }

  #referralTable tbody td.sticky-col {
    background: inherit;
    font-weight: 500;
    color: #0077c7;
  }

  #referralTable tr.selected-row>td {
    background: #dbeafe !important;
  }

  #referralTable tr.selected-row>td.sticky-col {
    background: #dbeafe !important;
  }

  /* ===== SmartHR/HRMOS風 企業詳細パネル ===== */
  .referral-detail-panel {
    background: #ffffff;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
    overflow: hidden;
    margin-bottom: 20px;
    max-width: 100%;
    box-sizing: border-box;
  }

  .referral-detail-header {
    background: linear-gradient(135deg, #0077c7 0%, #00a0e9 100%);
    color: white;
    padding: 20px 24px;
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
  }

  .referral-detail-company {
    font-size: 20px;
    font-weight: 700;
    margin: 0 0 4px 0;
  }

  .referral-detail-meta {
    font-size: 13px;
    opacity: 0.9;
  }

  .referral-detail-tags {
    display: flex;
    gap: 8px;
    margin-top: 12px;
  }

  .referral-detail-tag {
    background: rgba(255, 255, 255, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
  }

  .referral-detail-body {
    padding: 20px;
    max-width: 100%;
    overflow-x: auto;
    box-sizing: border-box;
  }

  .referral-detail-section {
    margin-bottom: 24px;
  }

  .referral-detail-section:last-child {
    margin-bottom: 0;
  }

  .referral-detail-section-title {
    font-size: 14px;
    font-weight: 600;
    color: #0077c7;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .referral-detail-section-title::before {
    content: "";
    display: inline-block;
    width: 4px;
    height: 16px;
    background: #0077c7;
    border-radius: 2px;
  }

  .referral-detail-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin-bottom: 20px;
  }

  @media (max-width: 768px) {
    .referral-detail-stats {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  .referral-detail-stat {
    background: #f8fafc;
    border-radius: 10px;
    padding: 16px;
    text-align: center;
    border: 1px solid #e2e8f0;
  }

  .referral-detail-stat.highlight {
    background: linear-gradient(135deg, #dbeafe 0%, #e0f2fe 100%);
    border-color: #93c5fd;
  }

  .referral-detail-stat-value {
    font-size: 24px;
    font-weight: 700;
    color: #0077c7;
  }

  .referral-detail-stat-label {
    font-size: 11px;
    color: #64748b;
    margin-top: 4px;
  }

  .referral-detail-memo {
    background: #fffbeb;
    border: 1px solid #fde68a;
    border-radius: 8px;
    padding: 16px;
    font-size: 13px;
    line-height: 1.7;
    color: #78716c;
  }

  .referral-detail-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
  }

  .referral-detail-card {
    background: #f8fafc;
    border-radius: 10px;
    padding: 16px;
    border: 1px solid #e2e8f0;
  }

  .referral-detail-card-title {
    font-size: 12px;
    font-weight: 600;
    color: #64748b;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .referral-detail-card-content {
    font-size: 13px;
    color: #334155;
    line-height: 1.6;
  }

  .referral-detail-close {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    font-size: 18px;
    cursor: pointer;
    transition: background 0.15s;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .referral-detail-close:hover {
    background: rgba(255, 255, 255, 0.3);
  }
</style>

<!-- 紹介先企業管理ページ -->
<div data-page="referral" class="section-shell space-y-6 max-w-screen-2xl mx-auto w-full">

  <!-- アクションボタン -->
  <div class="flex items-center justify-between flex-wrap gap-3 mb-4">
    <button id="referralCreateToggle" type="button" aria-expanded="false" aria-controls="referralCreateFormPanel"
      class="referral-action-btn">
      <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path d="M12 5v14M5 12h14" />
      </svg>
      新規紹介先企業登録
    </button>
  </div>
  <div id="referralCreateStatus" class="text-xs font-semibold text-indigo-600"></div>
  <div id="referralCreateFormPanel" class="space-y-4 mt-3 rounded-lg border border-indigo-100 bg-white/80 p-4 hidden">
    <div class="border border-slate-200 rounded-lg p-3 bg-slate-50 space-y-3">
      <div class="flex items-center justify-between">
        <div class="text-xs font-semibold text-slate-600">&#22522;&#26412;&#24773;&#22577;</div>
        <div class="text-[11px] text-slate-400">* &#24517;&#38920;</div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <label class="flex flex-col gap-1">
          <span class="text-xs font-semibold text-slate-600">&#x4F01;&#x696D;&#x540D; *</span>
          <input type="text" id="referralCreateCompany" required
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm"
            placeholder="&#20363;&#65289;&#26666;&#24335;&#20250;&#31038;&#12469;&#12531;&#12503;&#12523;" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs font-semibold text-slate-600">&#21215;&#38598;&#32887;&#31278; *</span>
          <input type="text" id="referralCreateJobTitle" required
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm"
            placeholder="&#20363;&#65289;&#12456;&#12531;&#12472;&#12491;&#12450; / &#12475;&#12540;&#12523;&#12473;" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs font-semibold text-slate-600">&#x63A1;&#x7528;&#x4E88;&#x5B9A;&#x4EBA;&#x6570;</span>
          <input type="number" min="0" id="referralCreatePlanHeadcount"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="&#20363;&#65289;5" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs font-semibold text-slate-600">&#x696D;&#x754C;</span>
          <input type="text" id="referralCreateIndustry"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm"
            placeholder="&#20363;&#65289;IT / SaaS" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs font-semibold text-slate-600">勤務地</span>
          <input type="text" id="referralCreateLocation"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="例）東京 / リモート" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs font-semibold text-slate-600">担当者名</span>
          <input type="text" id="referralCreateContactName"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="例）山田 太郎" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs font-semibold text-slate-600">担当者メールアドレス</span>
          <input type="email" id="referralCreateContactEmail"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="例）yamada@example.com" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs font-semibold text-slate-600">Fee (&#x5186;)</span>
          <input type="number" min="0" id="referralCreateFee"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm"
            placeholder="&#20363;&#65289;3000000" />
        </label>
      </div>
    </div>
    <div class="border border-slate-200 rounded-lg p-3 bg-slate-50 space-y-3">
      <div class="flex items-center justify-between">
        <div class="text-xs font-semibold text-slate-600">
          &#12411;&#12375;&#12356;&#20154;&#26448;&#65288;&#20219;&#24847;&#65289;</div>
        <div class="text-[11px] text-slate-400">&#12459;&#12531;&#12510;&#21306;&#20999;&#12426;</div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <label class="flex flex-col gap-1">
          <span
            class="text-xs font-semibold text-slate-600">&#24180;&#21454;&#19979;&#38480;&#65288;&#19975;&#20870;&#65289;</span>
          <input type="number" min="0" id="referralCreateSalaryMin"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="300" />
        </label>
        <label class="flex flex-col gap-1">
          <span
            class="text-xs font-semibold text-slate-600">&#24180;&#21454;&#19978;&#38480;&#65288;&#19975;&#20870;&#65289;</span>
          <input type="number" min="0" id="referralCreateSalaryMax"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="600" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs font-semibold text-slate-600">&#24076;&#26395;&#21220;&#21209;&#22320;</span>
          <input type="text" id="referralCreateLocations"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm"
            placeholder="&#26481;&#20140;, &#12522;&#12514;&#12540;&#12488;" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs font-semibold text-slate-600">&#24517;&#38920;&#36039;&#26684;</span>
          <input type="text" id="referralCreateMust"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="TOEIC, AWS" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs font-semibold text-slate-600">&#27475;&#36814;&#36039;&#26684;</span>
          <input type="text" id="referralCreateNice"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm"
            placeholder="IT&#12497;&#12473;&#12509;&#12540;&#12488;" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs font-semibold text-slate-600">&#24615;&#26684;&#20670;&#21521;</span>
          <input type="text" id="referralCreatePersonality"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm"
            placeholder="&#20027;&#20307;&#24615;, &#21332;&#35519;&#24615;" />
        </label>
      </div>
      <label class="flex flex-col gap-1">
        <span class="text-xs font-semibold text-slate-600">&#32076;&#39443;</span>
        <textarea id="referralCreateExperiences" rows="2"
          class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm"
          placeholder="&#12459;&#12531;&#12510;&#21306;&#20999;&#12426;"></textarea>
      </label>
    </div>
    <!-- 契約情報 -->
    <div class="border border-slate-300 rounded-lg p-3 bg-gradient-to-br from-slate-50 to-blue-50 space-y-3">
      <div class="flex items-center justify-between">
        <div class="text-xs font-semibold text-slate-700">契約情報（人材会社 ⇔ 顧客企業間）</div>
        <div class="text-[11px] text-slate-400">任意</div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <label class="flex flex-col gap-1">
          <span class="text-xs font-semibold text-slate-600">返金保証期間</span>
          <input type="text" id="referralCreateWarrantyPeriod"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="例：90日、3ヶ月" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs font-semibold text-slate-600">Fee契約内容</span>
          <input type="text" id="referralCreateFeeContract"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="Fee契約の詳細" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs font-semibold text-slate-600">その他</span>
          <input type="text" id="referralCreateContractNotes"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="その他の契約メモ" />
        </label>
      </div>
    </div>
    <!-- 選考メモ -->
    <div class="border border-slate-300 rounded-lg p-3 bg-gradient-to-br from-slate-50 to-white space-y-2">
      <div class="flex items-center justify-between">
        <div class="text-xs font-semibold text-slate-700 flex items-center gap-1.5">
          <span>📋</span>
          <span>選考メモ</span>
        </div>
        <div class="text-[11px] text-slate-400">任意</div>
      </div>
      <textarea id="referralCreateSelectionNote" rows="3"
        class="w-full bg-white border border-slate-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-400"
        placeholder="選考メモを入力（例：リーダー候補としての採用、主体性と協調性を重視）"></textarea>
    </div>
    <div class="flex items-center gap-2 justify-end">
      <button id="referralCreateSubmit"
        class="px-4 py-2 bg-indigo-600 text-white rounded-md text-sm font-semibold hover:bg-indigo-500">
        &#x767B;&#x9332;
      </button>
      <button id="referralCreateReset"
        class="px-4 py-2 border border-slate-300 rounded-md text-sm text-slate-600 hover:bg-slate-100">
        &#x30AF;&#x30EA;&#x30A2;
      </button>
    </div>
  </div>
</div>
<!-- モダンフィルターバー -->
<div class="referral-filter-bar">
  <div class="referral-filter-group">
    <span class="referral-filter-label">企業名検索</span>
    <input type="text" id="referralCompanyFilter" class="referral-filter-input" placeholder="企業名で絞り込み..."
      style="min-width: 180px;" />
  </div>
  <div class="referral-filter-group">
    <span class="referral-filter-label">期間</span>
    <input type="date" id="referralDateStart" class="referral-filter-input" value="2024-01-01" />
    <span style="color: #94a3b8;">〜</span>
    <input type="date" id="referralDateEnd" class="referral-filter-input" value="2025-12-31" />
  </div>
  <div class="referral-filter-group">
    <span class="referral-filter-label">職種</span>
    <select id="referralJobFilter" class="referral-filter-input">
      <option value="">全て</option>
      <option value="エンジニア">エンジニア</option>
      <option value="セールス">セールス</option>
      <option value="マネージャー">マネージャー</option>
    </select>
  </div>
  <div class="referral-filter-group">
    <span class="referral-filter-label">並び替え</span>
    <select id="referralSortSelect" class="referral-filter-input">
      <option value="company-asc">企業名（昇順）</option>
      <option value="proposal-desc">推薦件数（降順）</option>
      <option value="docScreen-desc">書類選考（降順）</option>
      <option value="interview1-desc">一次面接（降順）</option>
      <option value="offer-desc">内定（降順）</option>
      <option value="joined-desc">入社（降順）</option>
      <option value="fee-desc">合計Fee（降順）</option>
    </select>
  </div>
  <div style="margin-left: auto; display: flex; align-items: center; gap: 12px;">
    <button id="referralFilterReset" class="referral-filter-btn referral-filter-btn-secondary">リセット</button>
    <button id="referralExportBtn" class="referral-filter-btn referral-filter-btn-primary">
      <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
        style="display: inline-block; vertical-align: middle; margin-right: 4px;">
        <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3" />
      </svg>
      CSVエクスポート
    </button>
    <div id="referralFilterCount" class="referral-count-badge">-社</div>
  </div>
</div>

<!-- テーブル + 詳細 -->
<div class="space-y-4">
  <!-- テーブル（先） -->
  <div class="referral-table-wrapper table-surface table-teleapo max-w-full mx-auto w-full" style="overflow-x: auto;">
    <table class="table-grid min-w-[2100px] w-full" id="referralTable">
      <thead>
        <tr>
          <th
            class="sticky top-0 left-0 bg-slate-50 z-[60] cursor-pointer hover:bg-slate-100 sortable min-w-[200px] border-r border-slate-100 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]"
            data-sort="company" style="position: sticky; left: 0; top: 0; z-index: 60;">
            企業名</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[130px]"
            data-sort="remaining">残り人数</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[160px]"
            data-sort="jobTitle">募集職種</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[140px]"
            data-sort="planHeadcount">採用予定人数</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[120px]"
            data-sort="proposal">推薦件数</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[120px]"
            data-sort="docScreen">書類選考</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[120px]"
            data-sort="interview1">一次面接</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[120px]"
            data-sort="interview2">二次面接</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[100px]"
            data-sort="offer">内定</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[100px]"
            data-sort="joined">入社</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[140px]"
            data-sort="refundAmount">返金額</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[160px]"
            data-sort="leadTime">
            平均リードタイム<span class="text-[10px] font-normal text-slate-500 ml-1">（推薦から入社までの期間）</span>
          </th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[150px]"
            data-sort="retention" title="定着率 = 返金なし / 入社数">定着率<span
              class="text-[10px] font-normal text-slate-500 ml-1">（返金発生期間）</span></th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[120px]"
            data-sort="fee">合計Fee</th>
          <th class="sticky top-0 bg-slate-50 z-20 hover:bg-slate-100 min-w-[200px]">入社前辞退理由</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[150px]"
            data-sort="prejoinDeclines">入社辞退人数</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[160px]"
            data-sort="dropoutCount">選考脱落者人数</th>
        </tr>
      </thead>
      <tbody id="referralTableBody"></tbody>
    </table>
  </div>

  <!-- ページネーション（テーブルの直後） -->
  <div class="flex items-center justify-between mt-4">
    <div class="flex items-center gap-2 text-sm text-slate-500">
      <button
        class="px-3 py-2 border border-slate-300 rounded-md text-sm hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed"
        id="referralPrevBtn" disabled>前のページ</button>
      <span class="px-3 py-2 text-sm" id="referralPageInfo">1 / 1</span>
      <button
        class="px-3 py-2 border border-slate-300 rounded-md text-sm hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed"
        id="referralNextBtn" disabled>次のページ</button>
    </div>
    <div class="flex items-center gap-2 text-sm">
      <label class="text-xs text-slate-500">表示件数</label>
      <select class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" id="referralPageSize">
        <option value="25">25件</option>
        <option value="50" selected>50件</option>
        <option value="100">100件</option>
      </select>
    </div>
  </div>

  <!-- 企業詳細（テーブルの下） -->
  <div id="referralCompanyDetail" class="hidden" style="max-width: 100%;"></div>
</div>


<!-- AIマッチング -->
<div class="section-shell space-y-4 max-w-screen-2xl mx-auto w-full">
  <div
    class="border border-indigo-200 border-l-4 border-l-indigo-400 rounded-xl p-5 bg-gradient-to-br from-indigo-50 via-white to-slate-50 space-y-4">
    <div class="flex items-center justify-between flex-wrap gap-2">
      <div>
        <h3 class="text-base font-semibold text-indigo-900">AIマッチング</h3>
        <p class="text-xs text-slate-500">候補者プロフィールまたは条件を指定して、最適な企業をマッチングします</p>
      </div>
    </div>
    <div class="border-b border-indigo-200">
      <nav class="-mb-px flex space-x-8">
        <button class="py-2 px-1 border-b-2 border-indigo-500 text-indigo-600 text-sm font-medium"
          id="matchTabCandidate">候補者でマッチ</button>
        <button class="py-2 px-1 border-b-2 border-transparent text-slate-500 hover:text-slate-700 text-sm font-medium"
          id="matchTabCondition">条件指定でマッチ</button>
      </nav>
    </div>
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="space-y-4" id="matchCandidatePanel">
        <div class="border border-slate-200 rounded-lg p-4 bg-slate-50">
          <h4 class="text-sm font-semibold text-slate-700 mb-3">候補者プロフィール</h4>
          <textarea id="candidateText" rows="6" class="w-full border border-slate-300 rounded-md px-3 py-2 text-sm"
            placeholder="候補者のプロフィールやスキル、要望を入力してください..."></textarea>
          <div class="mt-3">
            <button id="matchFromCandidate"
              class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-500 text-sm font-medium">マッチング実行</button>
          </div>
        </div>
      </div>
      <div class="space-y-4 hidden" id="matchConditionPanel">
        <div class="border border-slate-200 rounded-lg p-4 bg-slate-50">
          <h4 class="text-sm font-semibold text-slate-700 mb-3">条件指定</h4>
          <div class="space-y-3">
            <div class="grid grid-cols-2 gap-3">
              <label class="flex flex-col gap-1"><span
                  class="text-xs font-semibold text-slate-600">年収下限（万円）</span><input type="number"
                  id="conditionSalaryMin" step="100" min="0" value="300"
                  class="border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="300" /></label>
              <label class="flex flex-col gap-1"><span
                  class="text-xs font-semibold text-slate-600">年収上限（万円）</span><input type="number"
                  id="conditionSalaryMax" step="100" min="0" value="300"
                  class="border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="300" /></label>
            </div>
            <label class="flex flex-col gap-1"><span class="text-xs font-semibold text-slate-600">職種</span><input
                type="text" id="conditionJobTitle" class="border border-slate-300 rounded-md px-3 py-2 text-sm"
                placeholder="データサイエンティスト / PM / エンジニアなど" /></label>
            <label class="flex flex-col gap-1"><span
                class="text-xs font-semibold text-slate-600">勤務地（カンマ区切り可）</span><input type="text"
                id="conditionLocation" class="border border-slate-300 rounded-md px-3 py-2 text-sm"
                placeholder="東京, 名古屋, リモート など" /></label>
            <label class="flex flex-col gap-1"><span
                class="text-xs font-semibold text-slate-600">必須資格（カンマ区切り）</span><input type="text"
                id="conditionMustQualifications" class="border border-slate-300 rounded-md px-3 py-2 text-sm"
                placeholder="PMP, 統計検定2級 など" /></label>
            <label class="flex flex-col gap-1"><span
                class="text-xs font-semibold text-slate-600">歓迎資格（カンマ区切り）</span><input type="text"
                id="conditionNiceQualifications" class="border border-slate-300 rounded-md px-3 py-2 text-sm"
                placeholder="G検定, AWS SAA など" /></label>
            <label class="flex flex-col gap-1"><span
                class="text-xs font-semibold text-slate-600">性格・特性（カンマ区切り）</span><input type="text"
                id="conditionPersonality" class="border border-slate-300 rounded-md px-3 py-2 text-sm"
                placeholder="リーダーシップ, 調整力 など" /></label>
            <label class="flex flex-col gap-1"><span
                class="text-xs font-semibold text-slate-600">経験・キーワード（カンマ区切り）</span><textarea id="conditionExperiences"
                rows="2" class="border border-slate-300 rounded-md px-3 py-2 text-sm"
                placeholder="需要予測, MLOps, SaaS営業5年以上 など"></textarea></label>
            <label class="flex flex-col gap-1"><span
                class="text-xs font-semibold text-slate-600">スキル・その他キーワード</span><textarea id="conditionSkills" rows="2"
                class="border border-slate-300 rounded-md px-3 py-2 text-sm"
                placeholder="Python, AWS, 英語ビジネス など"></textarea></label>
            <div class="mt-3">
              <button id="matchFromCondition"
                class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-500 text-sm font-medium">マッチング実行</button>
            </div>
          </div>
        </div>
      </div>
      <div class="space-y-4">
        <div class="border border-slate-200 rounded-lg p-4 bg-white">
          <div class="mb-3">
            <h4 class="text-sm font-semibold text-slate-700">マッチング結果（スコア順）</h4>
          </div>
          <div id="matchResults" class="space-y-3 min-h-[200px]">
            <div class="text-center text-slate-500 text-sm py-8">マッチングを実行すると結果が表示されます</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="referral-candidate-modal" id="referralCandidateModal" aria-hidden="true">
    <div class="referral-candidate-panel" role="dialog" aria-modal="true" aria-labelledby="referralCandidateModalTitle">
      <div class="referral-candidate-header">
        <div>
          <div class="referral-candidate-eyebrow">&#x5019;&#x88DC;&#x8005;&#x60C5;&#x5831;</div>
          <div class="referral-candidate-title" id="referralCandidateModalTitle">
            &#x5019;&#x88DC;&#x8005;&#x8A73;&#x7D30;
          </div>
        </div>
        <button class="referral-candidate-close" type="button" id="referralCandidateClose"
          aria-label="&#x9589;&#x3058;&#x308B;">&times;</button>
      </div>
      <div class="referral-candidate-body" id="referralCandidateModalBody"></div>
    </div>
  </div>