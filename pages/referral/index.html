<style>
  #referralTable thead th {
    position: sticky;
    top: 0;
    background: #fff;
    z-index: 30;
  }

  #referralTable .sticky-col-header {
    position: sticky;
    left: 0;
    top: 0;
    background: #fff;
    z-index: 50;
  }

  #referralTable .sticky-col {
    position: sticky;
    left: 0;
    z-index: 40;
  }

  .referral-table-wrapper {
    overflow-x: auto;
    overflow-y: visible;
  }

  /* 選択行ハイライトを右端まで維持 */
  #referralTable tr.selected-row>td {
    background: #eef2ff !important;
  }

  #referralTable tr.selected-row>td.sticky-col {
    position: sticky;
    left: 0;
    background: #eef2ff !important;

    z-index: 60;
  }
</style>

<!-- 紹介実績セクション -->
<div class="section-shell space-y-6 max-w-screen-2xl mx-auto w-full">
  <div class="flex items-center justify-between flex-wrap gap-3">
    <h3 class="text-xl font-semibold text-slate-900 whitespace-nowrap">紹介実績</h3>
    <div class="flex items-center gap-3 flex-wrap">
      <div class="flex items-center gap-2 flex-wrap">
        <input type="text" id="referralCompanyFilter"
          class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="企業名で絞り込み..." />
        <select id="referralSortSelect" class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm">
          <option value="company-asc">企業名（昇順）</option>
          <option value="proposal-desc">提案数（降順）</option>
          <option value="docScreen-desc">書類選考（降順）</option>
          <option value="interview1-desc">一次面接（降順）</option>
          <option value="interview2-desc">二次面接（降順）</option>
          <option value="offer-desc">内定（降順）</option>
          <option value="joined-desc">入社（降順）</option>
          <option value="planHeadcount-desc">採用予定人数（降順）</option>
          <option value="remaining-asc">残り人数（昇順）</option>
          <option value="retention-desc">定着率（降順）</option>
          <option value="leadTime-asc">平均リードタイム（昇順）</option>
          <option value="fee-desc">Fee（降順）</option>
          <option value="refundAmount-desc">返金額（降順）</option>
          <option value="prejoinDeclines-desc">入社前辞退人数（降順）</option>
          <option value="dropoutCount-desc">選考脱落者人数（降順）</option>
        </select>
      </div>
      <button id="referralExportBtn"
        class="px-3 py-2 border border-slate-300 rounded-md text-sm hover:bg-slate-100 whitespace-nowrap">CSVエクスポート</button>
    </div>
  </div>

  <!-- フィルタ -->
  <div class="border border-slate-200 rounded-lg p-4 bg-slate-50 space-y-3">
    <h4 class="text-sm font-semibold text-slate-700">絞り込み条件</h4>
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 text-xs text-slate-500">
      <div class="flex flex-col gap-1">
        <label class="text-xs font-semibold text-slate-500">期間開始</label>
        <input type="date" id="referralDateStart" class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm"
          value="2024-01-01" />
      </div>
      <div class="flex flex-col gap-1">
        <label class="text-xs font-semibold text-slate-500">期間終了</label>
        <input type="date" id="referralDateEnd" class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm"
          value="2025-12-31" />
      </div>
      <div class="flex flex-col gap-1">
        <label class="text-xs font-semibold text-slate-500">職種</label>
        <select id="referralJobFilter" class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm">
          <option value="">全て</option>
          <option value="エンジニア">エンジニア</option>
          <option value="セールス">セールス</option>
          <option value="マネージャー">マネージャー</option>
        </select>
      </div>
      <div class="flex items-end gap-2">
        <button id="referralFilterReset"
          class="px-3 py-2 border border-slate-300 rounded-md text-sm hover:bg-slate-100 whitespace-nowrap">条件クリア</button>
        <div id="referralFilterCount" class="px-2 py-1 bg-indigo-100 text-indigo-700 rounded text-xs font-semibold">-社
        </div>
      </div>
    </div>
  </div>

  <!-- 詳細 + テーブル -->
  <div class="space-y-4">
    <div id="referralCompanyDetail" class="min-h-[260px]"></div>

    <div class="referral-table-wrapper table-surface max-w-screen-2xl mx-auto w-full">
      <table class="table-grid min-w-[2100px] w-full" id="referralTable">
        <thead>
          <tr>
            <th class="sticky-col-header cursor-pointer hover:bg-slate-100 sortable min-w-[200px]" data-sort="company">
              企業名</th>
            <th class="cursor-pointer hover:bg-slate-100 sortable min-w-[130px]" data-sort="remaining">残り人数</th>
            <th class="cursor-pointer hover:bg-slate-100 sortable min-w-[130px]" data-sort="retention">定着率</th>
            <th class="cursor-pointer hover:bg-slate-100 sortable min-w-[160px]" data-sort="jobTitle">募集職種</th>
            <th class="cursor-pointer hover:bg-slate-100 sortable min-w-[120px]" data-sort="proposal">提案件数</th>
            <th class="cursor-pointer hover:bg-slate-100 sortable min-w-[120px]" data-sort="docScreen">書類選考</th>
            <th class="cursor-pointer hover:bg-slate-100 sortable min-w-[120px]" data-sort="interview1">一次面接</th>
            <th class="cursor-pointer hover:bg-slate-100 sortable min-w-[120px]" data-sort="interview2">二次面接</th>
            <th class="cursor-pointer hover:bg-slate-100 sortable min-w-[100px]" data-sort="offer">内定</th>
            <th class="cursor-pointer hover:bg-slate-100 sortable min-w-[100px]" data-sort="joined">入社</th>
            <th class="cursor-pointer hover:bg-slate-100 sortable min-w-[140px]" data-sort="planHeadcount">採用予定人数</th>
            <th class="cursor-pointer hover:bg-slate-100 sortable min-w-[140px]" data-sort="refundAmount">返金額</th>
            <th class="cursor-pointer hover:bg-slate-100 sortable min-w-[160px]" data-sort="leadTime">平均リードタイム</th>
            <th class="cursor-pointer hover:bg-slate-100 sortable min-w-[120px]" data-sort="fee">Fee</th>
            <th class="hover:bg-slate-100 min-w-[200px]">入社前辞退理由</th>
            <th class="cursor-pointer hover:bg-slate-100 sortable min-w-[150px]" data-sort="prejoinDeclines">入社辞退人数</th>
            <th class="cursor-pointer hover:bg-slate-100 sortable min-w-[160px]" data-sort="dropoutCount">選考脱落者人数</th>
          </tr>
        </thead>
        <tbody id="referralTableBody"></tbody>
      </table>
    </div>
  </div>

  <!-- ページネーション -->
  <div class="flex items-center justify-between">
    <div class="flex items-center gap-2 text-sm text-slate-500">
      <button
        class="px-3 py-2 border border-slate-300 rounded-md text-sm hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed"
        id="referralPrevBtn" disabled>前のページ</button>
      <span class="px-3 py-2 text-sm" id="referralPageInfo">1 / 1</span>
      <button
        class="px-3 py-2 border border-slate-300 rounded-md text-sm hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed"
        id="referralNextBtn" disabled>次のページ</button>
    </div>
    <div class="flex items-center gap-2 text-sm">
      <label class="text-xs text-slate-500">表示件数</label>
      <select class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" id="referralPageSize">
        <option value="25">25件</option>
        <option value="50" selected>50件</option>
        <option value="100">100件</option>
      </select>
    </div>
  </div>
</div>

<!-- AIマッチング -->
<div class="section-shell space-y-4 max-w-screen-2xl mx-auto w-full">
  <h3 class="text-lg font-semibold text-slate-800 whitespace-nowrap">AIマッチング</h3>
  <div class="border-b border-slate-200">
    <nav class="-mb-px flex space-x-8">
      <button class="py-2 px-1 border-b-2 border-indigo-500 text-indigo-600 text-sm font-medium"
        id="matchTabCandidate">候補者でマッチ</button>
      <button class="py-2 px-1 border-b-2 border-transparent text-slate-500 hover:text-slate-700 text-sm font-medium"
        id="matchTabCondition">条件指定でマッチ</button>
    </nav>
  </div>
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div class="space-y-4" id="matchCandidatePanel">
      <div class="border border-slate-200 rounded-lg p-4 bg-slate-50">
        <h4 class="text-sm font-semibold text-slate-700 mb-3">候補者プロフィール</h4>
        <textarea id="candidateText" rows="6" class="w-full border border-slate-300 rounded-md px-3 py-2 text-sm"
          placeholder="候補者のプロフィールやスキル、要望を入力してください..."></textarea>
        <div class="mt-3">
          <button id="matchFromCandidate"
            class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-500 text-sm font-medium">マッチング実行</button>
        </div>
      </div>
    </div>
    <div class="space-y-4 hidden" id="matchConditionPanel">
      <div class="border border-slate-200 rounded-lg p-4 bg-slate-50">
        <h4 class="text-sm font-semibold text-slate-700 mb-3">条件指定</h4>
        <div class="space-y-3">
          <div class="grid grid-cols-2 gap-3">
            <label class="flex flex-col gap-1"><span class="text-xs font-semibold text-slate-600">年収下限（万円）</span><input
                type="number" id="conditionSalaryMin" step="100" min="0" value="300"
                class="border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="300" /></label>
            <label class="flex flex-col gap-1"><span class="text-xs font-semibold text-slate-600">年収上限（万円）</span><input
                type="number" id="conditionSalaryMax" step="100" min="0" value="300"
                class="border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="300" /></label>
          </div>
          <label class="flex flex-col gap-1"><span class="text-xs font-semibold text-slate-600">職種</span><input
              type="text" id="conditionJobTitle" class="border border-slate-300 rounded-md px-3 py-2 text-sm"
              placeholder="データサイエンティスト / PM / エンジニアなど" /></label>
          <label class="flex flex-col gap-1"><span
              class="text-xs font-semibold text-slate-600">勤務地（カンマ区切り可）</span><input type="text" id="conditionLocation"
              class="border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="東京, 名古屋, リモート など" /></label>
          <label class="flex flex-col gap-1"><span
              class="text-xs font-semibold text-slate-600">必須資格（カンマ区切り）</span><input type="text"
              id="conditionMustQualifications" class="border border-slate-300 rounded-md px-3 py-2 text-sm"
              placeholder="PMP, 統計検定2級 など" /></label>
          <label class="flex flex-col gap-1"><span
              class="text-xs font-semibold text-slate-600">歓迎資格（カンマ区切り）</span><input type="text"
              id="conditionNiceQualifications" class="border border-slate-300 rounded-md px-3 py-2 text-sm"
              placeholder="G検定, AWS SAA など" /></label>
          <label class="flex flex-col gap-1"><span
              class="text-xs font-semibold text-slate-600">性格・特性（カンマ区切り）</span><input type="text"
              id="conditionPersonality" class="border border-slate-300 rounded-md px-3 py-2 text-sm"
              placeholder="リーダーシップ, 調整力 など" /></label>
          <label class="flex flex-col gap-1"><span
              class="text-xs font-semibold text-slate-600">経験・キーワード（カンマ区切り）</span><textarea id="conditionExperiences"
              rows="2" class="border border-slate-300 rounded-md px-3 py-2 text-sm"
              placeholder="需要予測, MLOps, SaaS営業5年以上 など"></textarea></label>
          <label class="flex flex-col gap-1"><span
              class="text-xs font-semibold text-slate-600">スキル・その他キーワード</span><textarea id="conditionSkills" rows="2"
              class="border border-slate-300 rounded-md px-3 py-2 text-sm"
              placeholder="Python, AWS, 英語ビジネス など"></textarea></label>
          <div class="mt-3">
            <button id="matchFromCondition"
              class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-500 text-sm font-medium">マッチング実行</button>
          </div>
        </div>
      </div>
    </div>
    <div class="space-y-4">
      <div class="border border-slate-200 rounded-lg p-4 bg-white">
        <div class="mb-3">
          <h4 class="text-sm font-semibold text-slate-700">マッチング結果（スコア順）</h4>
        </div>
        <div id="matchResults" class="space-y-3 min-h-[200px]">
          <div class="text-center text-slate-500 text-sm py-8">マッチングを実行すると結果が表示されます</div>
        </div>
      </div>
    </div>
  </div>
</div>
