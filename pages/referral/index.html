<link rel="stylesheet" href="pages/referral/referral.css">


<!-- 紹介先企業管理ページ -->
<div data-page="referral" class="section-shell space-y-6 max-w-screen-2xl mx-auto w-full">

  <!-- アクションボタン -->
  <div class="flex items-center justify-between flex-wrap gap-3 mb-4">
    <button id="referralCreateToggle" type="button" aria-expanded="false" aria-controls="referralCreateFormPanel"
      class="referral-primary-btn">
      <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path d="M12 5v14M5 12h14" />
      </svg>
      新規紹介先企業登録
    </button>
  </div>
  <div id="referralCreateStatus" class="text-xs font-semibold text-indigo-600"></div>
  <div id="referralCreateFormPanel"
    class="space-y-4 mt-3 rounded-lg border border-indigo-100 bg-white/80 p-6 hidden shadow-sm">
    <div class="border border-slate-200 rounded-lg p-4 bg-slate-50 space-y-4">
      <div class="flex items-center justify-between">
        <div class="text-sm font-bold text-slate-700">基本情報</div>
        <div class="text-[11px] text-slate-400">* 必須</div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <label class="flex flex-col gap-1.5">
          <span class="text-xs font-semibold text-slate-600">企業名 *</span>
          <input type="text" id="referralCreateCompany" required class="referral-input" placeholder="例）株式会社サンブル" />
        </label>
        <label class="flex flex-col gap-1.5">
          <span class="text-xs font-semibold text-slate-600">募集職種 *</span>
          <input type="text" id="referralCreateJobTitle" required class="referral-input" placeholder="例）エンジニア / セールス" />
        </label>
        <label class="flex flex-col gap-1.5">
          <span class="text-xs font-semibold text-slate-600">採用予定人数</span>
          <input type="number" min="0" id="referralCreatePlanHeadcount" class="referral-input" placeholder="例）5" />
        </label>
        <label class="flex flex-col gap-1.5">
          <span class="text-xs font-semibold text-slate-600">業界</span>
          <input type="text" id="referralCreateIndustry" class="referral-input" placeholder="例）IT / SaaS" />
        </label>
        <label class="flex flex-col gap-1.5">
          <span class="text-xs font-semibold text-slate-600">勤務地</span>
          <input type="text" id="referralCreateLocation" class="referral-input" placeholder="例）東京 / リモート" />
        </label>
        <label class="flex flex-col gap-1.5">
          <span class="text-xs font-semibold text-slate-600">担当者名</span>
          <input type="text" id="referralCreateContactName"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="例）山田 太郎" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs font-semibold text-slate-600">担当者メールアドレス</span>
          <input type="email" id="referralCreateContactEmail"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="例）yamada@example.com" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs font-semibold text-slate-600">Fee (&#x5186;)</span>
          <input type="number" min="0" id="referralCreateFee"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm"
            placeholder="&#20363;&#65289;3000000" />
        </label>
      </div>
    </div>
    <div class="border border-slate-200 rounded-lg p-3 bg-slate-50 space-y-3">
      <div class="flex items-center justify-between">
        <div class="text-xs font-semibold text-slate-600">
          &#12411;&#12375;&#12356;&#20154;&#26448;&#65288;&#20219;&#24847;&#65289;</div>
        <div class="text-[11px] text-slate-400">&#12459;&#12531;&#12510;&#21306;&#20999;&#12426;</div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <label class="flex flex-col gap-1">
          <span
            class="text-xs font-semibold text-slate-600">&#24180;&#21454;&#19979;&#38480;&#65288;&#19975;&#20870;&#65289;</span>
          <input type="number" min="0" id="referralCreateSalaryMin"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="300" />
        </label>
        <label class="flex flex-col gap-1">
          <span
            class="text-xs font-semibold text-slate-600">&#24180;&#21454;&#19978;&#38480;&#65288;&#19975;&#20870;&#65289;</span>
          <input type="number" min="0" id="referralCreateSalaryMax"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="600" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs font-semibold text-slate-600">&#24076;&#26395;&#21220;&#21209;&#22320;</span>
          <input type="text" id="referralCreateLocations"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm"
            placeholder="&#26481;&#20140;, &#12522;&#12514;&#12540;&#12488;" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs font-semibold text-slate-600">&#24517;&#38920;&#36039;&#26684;</span>
          <input type="text" id="referralCreateMust"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="TOEIC, AWS" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs font-semibold text-slate-600">&#27475;&#36814;&#36039;&#26684;</span>
          <input type="text" id="referralCreateNice"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm"
            placeholder="IT&#12497;&#12473;&#12509;&#12540;&#12488;" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs font-semibold text-slate-600">&#24615;&#26684;&#20670;&#21521;</span>
          <input type="text" id="referralCreatePersonality"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm"
            placeholder="&#20027;&#20307;&#24615;, &#21332;&#35519;&#24615;" />
        </label>
      </div>
      <label class="flex flex-col gap-1">
        <span class="text-xs font-semibold text-slate-600">&#32076;&#39443;</span>
        <textarea id="referralCreateExperiences" rows="2"
          class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm"
          placeholder="&#12459;&#12531;&#12510;&#21306;&#20999;&#12426;"></textarea>
      </label>
    </div>
    <!-- 契約情報 -->
    <div class="border border-slate-300 rounded-lg p-3 bg-gradient-to-br from-slate-50 to-blue-50 space-y-3">
      <div class="flex items-center justify-between">
        <div class="text-xs font-semibold text-slate-700">契約情報（人材会社 ⇔ 顧客企業間）</div>
        <div class="text-[11px] text-slate-400">任意</div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <label class="flex flex-col gap-1">
          <span class="text-xs font-semibold text-slate-600">返金保証期間</span>
          <input type="text" id="referralCreateWarrantyPeriod"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="例：90日、3ヶ月" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs font-semibold text-slate-600">Fee契約内容</span>
          <input type="text" id="referralCreateFeeContract"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="Fee契約の詳細" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs font-semibold text-slate-600">その他</span>
          <input type="text" id="referralCreateContractNotes"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="その他の契約メモ" />
        </label>
      </div>
    </div>
    <!-- 選考メモ -->
    <div class="border border-slate-300 rounded-lg p-3 bg-gradient-to-br from-slate-50 to-white space-y-2">
      <div class="flex items-center justify-between">
        <div class="text-xs font-semibold text-slate-700 flex items-center gap-1.5">
          <span>選考メモ</span>
        </div>
        <div class="text-[11px] text-slate-400">任意</div>
      </div>
      <textarea id="referralCreateSelectionNote" rows="3"
        class="w-full bg-white border border-slate-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-400"
        placeholder="選考メモを入力（例：リーダー候補としての採用、主体性と協調性を重視）"></textarea>
    </div>
    <div class="flex items-center gap-2 justify-end">
      <button id="referralCreateSubmit"
        class="px-4 py-2 bg-indigo-600 text-white rounded-md text-sm font-semibold hover:bg-indigo-500">
        &#x767B;&#x9332;
      </button>
      <button id="referralCreateReset"
        class="px-4 py-2 border border-slate-300 rounded-md text-sm text-slate-600 hover:bg-slate-100">
        &#x30AF;&#x30EA;&#x30A2;
      </button>
    </div>
  </div>
</div>
<!-- モダンフィルターバー -->

<div class="referral-filter-bar">
  <div class="referral-filter-group">
    <span class="referral-filter-label">企業名検索</span>
    <input type="text" id="referralCompanyFilter" class="referral-filter-input" placeholder="企業名..." />
  </div>
  <div class="referral-filter-group">
    <span class="referral-filter-label">期間</span>
    <div style="display:flex; gap:8px; align-items:center;">
      <input type="date" id="referralDateStart" class="referral-filter-input" value="2024-01-01" />
      <span style="color: #cbd5e1;">-</span>
      <input type="date" id="referralDateEnd" class="referral-filter-input" value="2025-12-31" />
    </div>
  </div>
  <div class="referral-filter-group">
    <span class="referral-filter-label">職種</span>
    <select id="referralJobFilter" class="referral-filter-select">
      <option value="">全て</option>
      <option value="エンジニア">エンジニア</option>
      <option value="セールス">セールス</option>
      <option value="マネージャー">マネージャー</option>
    </select>
  </div>
  <div class="referral-action-btn-group">
    <button id="referralFilterReset" class="referral-secondary-btn">リセット</button>
    <button id="referralExportBtn" class="referral-primary-btn">
      CSVエクスポート
    </button>
    <div id="referralFilterCount"
      class="referral-count-badge bg-slate-900 text-white px-3 py-1 rounded-full text-xs font-semibold">-社</div>
  </div>
</div>

<!-- テーブル + 詳細 -->
<div class="space-y-4">
  <!-- テーブル（先） -->
  <div class="referral-table-wrapper table-surface table-teleapo max-w-full mx-auto w-full" style="overflow-x: auto;">
    <table class="table-grid min-w-[2100px] w-full" id="referralTable">
      <thead>
        <tr>
          <th
            class="sticky top-0 left-0 bg-slate-50 z-[60] cursor-pointer hover:bg-slate-100 sortable min-w-[200px] border-r border-slate-100 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]"
            data-sort="company" style="position: sticky; left: 0; top: 0; z-index: 60;">
            企業名</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[130px]"
            data-sort="remaining">残り人数</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[160px]"
            data-sort="jobTitle">募集職種</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[140px]"
            data-sort="planHeadcount">採用予定人数</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[120px]"
            data-sort="proposal">推薦件数</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[120px]"
            data-sort="docScreen">書類選考</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[120px]"
            data-sort="interview1">一次面接</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[120px]"
            data-sort="interview2">二次面接</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[100px]"
            data-sort="offer">内定</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[100px]"
            data-sort="joined">入社</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[140px]"
            data-sort="refundAmount">返金額</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[160px]"
            data-sort="leadTime">
            平均リードタイム<span class="text-[10px] font-normal text-slate-500 ml-1">（推薦から入社までの期間）</span>
          </th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[150px]"
            data-sort="retention" title="定着率 = 返金なし / 入社数">定着率<span
              class="text-[10px] font-normal text-slate-500 ml-1">（返金発生期間）</span></th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[120px]"
            data-sort="fee">合計Fee</th>
          <th class="sticky top-0 bg-slate-50 z-20 hover:bg-slate-100 min-w-[200px]">入社前辞退理由</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[150px]"
            data-sort="prejoinDeclines">入社辞退人数</th>
          <th class="sticky top-0 bg-slate-50 z-20 cursor-pointer hover:bg-slate-100 sortable min-w-[160px]"
            data-sort="dropoutCount">選考脱落者人数</th>
        </tr>
      </thead>
      <tbody id="referralTableBody"></tbody>
    </table>
  </div>

  <!-- ページネーション（テーブルの直後） -->
  <div class="flex items-center justify-between mt-4">
    <div class="flex items-center gap-2 text-sm text-slate-500">
      <button
        class="px-3 py-2 border border-slate-300 rounded-md text-sm hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed"
        id="referralPrevBtn" disabled>前のページ</button>
      <span class="px-3 py-2 text-sm" id="referralPageInfo">1 / 1</span>
      <button
        class="px-3 py-2 border border-slate-300 rounded-md text-sm hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed"
        id="referralNextBtn" disabled>次のページ</button>
    </div>
    <div class="flex items-center gap-2 text-sm">
      <label class="text-xs text-slate-500">表示件数</label>
      <select class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" id="referralPageSize">
        <option value="25">25件</option>
        <option value="50" selected>50件</option>
        <option value="100">100件</option>
      </select>
    </div>
  </div>

  <!-- 企業詳細（テーブルの下） -->
  <div id="referralCompanyDetail" class="hidden" style="max-width: 100%;"></div>
</div>


<!-- AIマッチング -->
<div class="section-shell space-y-4 max-w-screen-2xl mx-auto w-full">
  <div
    class="border border-indigo-200 border-l-4 border-l-indigo-400 rounded-xl p-5 bg-gradient-to-br from-indigo-50 via-white to-slate-50 space-y-4">
    <div class="flex items-center justify-between flex-wrap gap-2">
      <div>
        <h3 class="text-base font-semibold text-indigo-900">AIマッチング</h3>
        <p class="text-xs text-slate-500">候補者プロフィールまたは条件を指定して、最適な企業をマッチングします</p>
      </div>
    </div>
    <div class="border-b border-indigo-200">
      <nav class="-mb-px flex space-x-8">
        <button class="py-2 px-1 border-b-2 border-indigo-500 text-indigo-600 text-sm font-medium"
          id="matchTabCandidate">候補者でマッチ</button>
        <button class="py-2 px-1 border-b-2 border-transparent text-slate-500 hover:text-slate-700 text-sm font-medium"
          id="matchTabCondition">条件指定でマッチ</button>
      </nav>
    </div>
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="space-y-4" id="matchCandidatePanel">
        <div class="border border-slate-200 rounded-lg p-4 bg-slate-50">
          <h4 class="text-sm font-semibold text-slate-700 mb-3">候補者プロフィール</h4>
          <textarea id="candidateText" rows="6" class="w-full border border-slate-300 rounded-md px-3 py-2 text-sm"
            placeholder="候補者のプロフィールやスキル、要望を入力してください..."></textarea>
          <div class="mt-3">
            <button id="matchFromCandidate"
              class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-500 text-sm font-medium">マッチング実行</button>
          </div>
        </div>
      </div>
      <div class="space-y-4 hidden" id="matchConditionPanel">
        <div class="border border-slate-200 rounded-lg p-4 bg-slate-50">
          <h4 class="text-sm font-semibold text-slate-700 mb-3">条件指定</h4>
          <div class="space-y-3">
            <div class="grid grid-cols-2 gap-3">
              <label class="flex flex-col gap-1"><span
                  class="text-xs font-semibold text-slate-600">年収下限（万円）</span><input type="number"
                  id="conditionSalaryMin" step="100" min="0" value="300"
                  class="border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="300" /></label>
              <label class="flex flex-col gap-1"><span
                  class="text-xs font-semibold text-slate-600">年収上限（万円）</span><input type="number"
                  id="conditionSalaryMax" step="100" min="0" value="300"
                  class="border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="300" /></label>
            </div>
            <label class="flex flex-col gap-1"><span class="text-xs font-semibold text-slate-600">職種</span><input
                type="text" id="conditionJobTitle" class="border border-slate-300 rounded-md px-3 py-2 text-sm"
                placeholder="データサイエンティスト / PM / エンジニアなど" /></label>
            <label class="flex flex-col gap-1"><span
                class="text-xs font-semibold text-slate-600">勤務地（カンマ区切り可）</span><input type="text"
                id="conditionLocation" class="border border-slate-300 rounded-md px-3 py-2 text-sm"
                placeholder="東京, 名古屋, リモート など" /></label>
            <label class="flex flex-col gap-1"><span
                class="text-xs font-semibold text-slate-600">必須資格（カンマ区切り）</span><input type="text"
                id="conditionMustQualifications" class="border border-slate-300 rounded-md px-3 py-2 text-sm"
                placeholder="PMP, 統計検定2級 など" /></label>
            <label class="flex flex-col gap-1"><span
                class="text-xs font-semibold text-slate-600">歓迎資格（カンマ区切り）</span><input type="text"
                id="conditionNiceQualifications" class="border border-slate-300 rounded-md px-3 py-2 text-sm"
                placeholder="G検定, AWS SAA など" /></label>
            <label class="flex flex-col gap-1"><span
                class="text-xs font-semibold text-slate-600">性格・特性（カンマ区切り）</span><input type="text"
                id="conditionPersonality" class="border border-slate-300 rounded-md px-3 py-2 text-sm"
                placeholder="リーダーシップ, 調整力 など" /></label>
            <label class="flex flex-col gap-1"><span
                class="text-xs font-semibold text-slate-600">経験・キーワード（カンマ区切り）</span><textarea id="conditionExperiences"
                rows="2" class="border border-slate-300 rounded-md px-3 py-2 text-sm"
                placeholder="需要予測, MLOps, SaaS営業5年以上 など"></textarea></label>
            <label class="flex flex-col gap-1"><span
                class="text-xs font-semibold text-slate-600">スキル・その他キーワード</span><textarea id="conditionSkills" rows="2"
                class="border border-slate-300 rounded-md px-3 py-2 text-sm"
                placeholder="Python, AWS, 英語ビジネス など"></textarea></label>
            <div class="mt-3">
              <button id="matchFromCondition"
                class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-500 text-sm font-medium">マッチング実行</button>
            </div>
          </div>
        </div>
      </div>
      <div class="space-y-4">
        <div class="border border-slate-200 rounded-lg p-4 bg-white">
          <div class="mb-3">
            <h4 class="text-sm font-semibold text-slate-700">マッチング結果（スコア順）</h4>
          </div>
          <div id="matchResults" class="space-y-3 min-h-[200px]">
            <div class="text-center text-slate-500 text-sm py-8">マッチングを実行すると結果が表示されます</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="referral-candidate-modal" id="referralCandidateModal" aria-hidden="true">
    <div class="referral-candidate-panel" role="dialog" aria-modal="true" aria-labelledby="referralCandidateModalTitle">
      <div class="referral-candidate-header">
        <div>
          <div class="referral-candidate-eyebrow">&#x5019;&#x88DC;&#x8005;&#x60C5;&#x5831;</div>
          <div class="referral-candidate-title" id="referralCandidateModalTitle">
            &#x5019;&#x88DC;&#x8005;&#x8A73;&#x7D30;
          </div>
        </div>
        <button class="referral-candidate-close" type="button" id="referralCandidateClose"
          aria-label="&#x9589;&#x3058;&#x308B;">&times;</button>
      </div>
      <div class="referral-candidate-body" id="referralCandidateModalBody"></div>
    </div>
  </div>
