<section data-page="teleapo" class="kpi-v2-wrapper space-y-6">
  <nav class="teleapo-tab-nav" aria-label="新規アポ管理ナビゲーション">
    <div class="teleapo-tab-nav-inner">
      <!-- 左側：画面タイトル -->
      <div class="teleapo-tab-nav-title">
        新規アポ管理
      </div>

      <!-- 右側：タブ -->
      <div class="teleapo-tab-nav-tabs">
        <button type="button" class="teleapo-tab-btn teleapo-tab-btn-active"
          data-teleapo-tab-target="#teleapoSectionKpi">
          全体KPI表示
        </button>
        <button type="button" class="teleapo-tab-btn" data-teleapo-tab-target="#teleapoSectionEmployees">
          社員成績
        </button>
        <button type="button" class="teleapo-tab-btn" data-teleapo-tab-target="#teleapoSectionHeatmap">
          通電率分析
        </button>
        <button type="button" class="teleapo-tab-btn" data-teleapo-tab-target="#teleapoSectionLogForm">
          新規架電ログ追加
        </button>
        <button type="button" class="teleapo-tab-btn" data-teleapo-tab-target="#teleapoSectionLogs">
          架電ログ
        </button>
      </div>
    </div>
  </nav>



  <!-- 上部：全体KPI（率＋件数） -->
  <div class="kpi-v2-section kpi-v2-summary-section" id="teleapoSectionKpi">

    <div class="flex items-start justify-between mb-2 gap-4">
      <div>
        <h3 id="teleapoSummaryTitle" class="kpi-v2-title">
          選択期間の全体KPI
        </h3>
      </div>
      <div class="text-xs text-slate-500 flex items-center">
        表示対象：
        <span id="teleapoSummaryScopeLabel" class="font-semibold text-slate-700 ml-1">全体</span>
        <button type="button" id="teleapoSummaryResetBtn"
          class="ml-3 px-2 py-1 border border-slate-300 rounded-md text-[11px] text-slate-600 hover:bg-slate-100">
          全体に戻す
        </button>
      </div>
    </div>

    <!-- 率パネル：コンタクト率 / 設定率 / 着座率 -->
    <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-3">

      <!-- コンタクト率 -->
      <div class="bg-white border border-slate-200 rounded-xl p-3 shadow-sm">
        <div class="flex items-center justify-between mb-1">
          <span class="text-xs font-semibold text-slate-700">コンタクト率（総合）</span>
        </div>
        <div class="text-2xl md:text-3xl font-bold text-slate-900 tracking-tight" id="teleapoKpiContactRateTotal">
          -
        </div>
        <div class="mt-2 grid grid-cols-2 gap-1 text-[11px] text-slate-600">
          <div class="flex items-center justify-between">
            <span>通電ルート</span>
            <span id="teleapoKpiContactRateTel" class="font-semibold text-slate-800">-</span>
          </div>
          <div class="flex items-center justify-between">
            <span>その他ルート</span>
            <span id="teleapoKpiContactRateOther" class="font-semibold text-slate-800">-</span>
          </div>
        </div>
      </div>

      <!-- 設定率 -->
      <div class="bg-white border border-slate-200 rounded-xl p-3 shadow-sm">
        <div class="flex items-center justify-between mb-1">
          <span class="text-xs font-semibold text-slate-700">設定率（総合）</span>
        </div>
        <div class="text-2xl md:text-3xl font-bold text-slate-900 tracking-tight" id="teleapoKpiSetRateTotal">
          -
        </div>
        <div class="mt-2 grid grid-cols-2 gap-1 text-[11px] text-slate-600">
          <div class="flex items-center justify-between">
            <span>通電ルート</span>
            <span id="teleapoKpiSetRateTel" class="font-semibold text-slate-800">-</span>
          </div>
          <div class="flex items-center justify-between">
            <span>その他ルート</span>
            <span id="teleapoKpiSetRateOther" class="font-semibold text-slate-800">-</span>
          </div>
        </div>
      </div>

      <!-- 着座率 -->
      <div class="bg-white border border-slate-200 rounded-xl p-3 shadow-sm">
        <div class="flex items-center justify-between mb-1">
          <span class="text-xs font-semibold text-slate-700">着座率（総合）</span>
        </div>
        <div class="text-2xl md:text-3xl font-bold text-slate-900 tracking-tight" id="teleapoKpiShowRateTotal">
          -
        </div>
        <div class="mt-2 grid grid-cols-2 gap-1 text-[11px] text-slate-600">
          <div class="flex items-center justify-between">
            <span>通電ルート</span>
            <span id="teleapoKpiShowRateTel" class="font-semibold text-slate-800">-</span>
          </div>
          <div class="flex items-center justify-between">
            <span>その他ルート</span>
            <span id="teleapoKpiShowRateOther" class="font-semibold text-slate-800">-</span>
          </div>
        </div>
      </div>
    </div>

    <div class="mt-3 grid grid-cols-1 md:grid-cols-4 gap-3">

      <!-- 架電数（通電ルートのみ） -->
      <div class="bg-white border border-slate-200 rounded-xl p-3 shadow-sm">
        <div class="flex items-center justify-between mb-1">
          <div class="text-xs font-semibold text-slate-700">架電数（通電ルート）</div>
        </div>
        <div class="text-xl md:text-2xl font-bold text-slate-900" id="teleapoKpiDialsTel">
          0
        </div>
        <p class="mt-1 text-[11px] text-slate-500">
          ※その他ルートには架電は含まれません
        </p>
      </div>

      <!-- コンタクト数 -->
      <div class="bg-white border border-slate-200 rounded-xl p-3 shadow-sm">
        <div class="flex items-center justify-between mb-1">
          <div class="text-xs font-semibold text-slate-700">コンタクト数（総合）</div>
        </div>
        <!-- 総合を大きく -->
        <div class="text-xl md:text-2xl font-bold text-slate-900 tracking-tight" id="teleapoKpiContactsTotal">
          0
        </div>
        <!-- 通電 / その他を小さく -->
        <div class="mt-2 grid grid-cols-2 gap-1 text-[11px] text-slate-600">
          <div class="flex items-center justify-between">
            <span>通電ルート</span>
            <span id="teleapoKpiContactsTel" class="font-semibold text-slate-800">0</span>
          </div>
          <div class="flex items-center justify-between">
            <span>その他ルート</span>
            <span id="teleapoKpiContactsOther" class="font-semibold text-slate-800">0</span>
          </div>
        </div>
      </div>

      <!-- 設定数 -->
      <div class="bg-white border border-slate-200 rounded-xl p-3 shadow-sm">
        <div class="flex items-center justify-between mb-1">
          <div class="text-xs font-semibold text-slate-700">設定数（総合）</div>
        </div>
        <div class="text-xl md:text-2xl font-bold text-slate-900 tracking-tight" id="teleapoKpiSetsTotal">
          0
        </div>
        <div class="mt-2 grid grid-cols-2 gap-1 text-[11px] text-slate-600">
          <div class="flex items-center justify-between">
            <span>通電ルート</span>
            <span id="teleapoKpiSetsTel" class="font-semibold text-slate-800">0</span>
          </div>
          <div class="flex items-center justify-between">
            <span>その他ルート</span>
            <span id="teleapoKpiSetsOther" class="font-semibold text-slate-800">0</span>
          </div>
        </div>
      </div>

      <!-- 着座数 -->
      <div class="bg-white border border-slate-200 rounded-xl p-3 shadow-sm">
        <div class="flex items-center justify-between mb-1">
          <div class="text-xs font-semibold text-slate-700">着座数（総合）</div>
        </div>
        <div class="text-xl md:text-2xl font-bold text-slate-900 tracking-tight" id="teleapoKpiShowsTotal">
          0
        </div>
        <div class="mt-2 grid grid-cols-2 gap-1 text-[11px] text-slate-600">
          <div class="flex items-center justify-between">
            <span>通電ルート</span>
            <span id="teleapoKpiShowsTel" class="font-semibold text-slate-800">0</span>
          </div>
          <div class="flex items-center justify-between">
            <span>その他ルート</span>
            <span id="teleapoKpiShowsOther" class="font-semibold text-slate-800">0</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 社員成績 & ヒートマップ -->
  <div class="kpi-v2-section">
    <div class="kpi-v2-header mb-1">
      <div class="flex flex-col gap-1">
        <!-- ここだけで「表示期間：YYYY/MM/DD 〜 YYYY/MM/DD」を表現 -->
        <p class="kpi-v2-period-label text-xs text-slate-700" id="teleapoCompanyPeriodLabel">
          <!-- JSで「表示期間：2025/10/31 〜 2025/11/21」をセット -->
        </p>
      </div>
      <div class="flex flex-col items-end gap-1">
        <div class="flex items-center gap-2">
          <input type="date" id="teleapoCompanyRangeStart" class="kpi-v2-date-input" />
          <span class="kpi-v2-date-separator">〜</span>
          <input type="date" id="teleapoCompanyRangeEnd" class="kpi-v2-date-input" />
        </div>
        <div class="kpi-v2-range-presets flex gap-1" data-scope="company">
          <button type="button" class="kpi-v2-range-btn" data-preset="today">今日</button>
          <button type="button" class="kpi-v2-range-btn" data-preset="thisWeek">今週</button>
          <button type="button" class="kpi-v2-range-btn kpi-v2-range-btn-active" data-preset="thisMonth">
            今月
          </button>
        </div>
      </div>
    </div>


    <!-- 社員成績 -->
    <div class="kpi-v2-subsection" id="teleapoSectionEmployees">
      <div class="flex items-center justify-between mb-2">
        <h4 class="text-base font-semibold text-slate-800">社員成績（通電ルートのみ）</h4>
        <select id="teleapoEmployeeSortSelect" class="bg-white border border-slate-300 rounded-md px-3 py-1.5 text-xs">
          <option value="connectRate-desc">通電率（高い順）</option>
          <option value="setRate-desc">設定率（高い順）</option>
          <option value="showRate-desc">着座率（高い順）</option>
        </select>
      </div>

      <div id="teleapoEmployeeTableWrapper" class="overflow-auto rounded-lg border border-slate-200 mb-4 bg-white">
        <table class="table-grid min-w-[800px]">
          <thead>
            <tr>
              <th class="whitespace-nowrap">社員名</th>
              <th class="whitespace-nowrap">架電数</th>
              <th class="whitespace-nowrap">通電数</th>
              <th class="whitespace-nowrap">設定数</th>
              <th class="whitespace-nowrap">着座数</th>
              <th class="whitespace-nowrap">通電率</th>
              <th class="whitespace-nowrap">設定率</th>
              <th class="whitespace-nowrap">着座率</th>
            </tr>
          </thead>
          <tbody id="teleapoEmployeeTableBody">
            <!-- JSで生成 -->
          </tbody>
        </table>
      </div>
    </div>
    <!-- 社員別 時系列グラフ（通電率・設定率・着座率） -->
    <div id="teleapoEmployeeChartWrapper" class="kpi-v2-subsection hidden">
      <h5 id="teleapoEmployeeChartTitle" class="text-sm font-semibold text-slate-800 mb-2">
        社員別 時系列KPI（通電率・設定率・着座率）
      </h5>
      <div class="kpi-v2-chart-container">
        <svg id="teleapoEmployeeTrendChart" viewBox="0 0 800 260" class="w-full h-auto"></svg>
      </div>
    </div>

    <!-- ヒートマップ（通電率のみ） -->
    <div class="kpi-v2-subsection" id="teleapoSectionHeatmap">
      <h4 class="kpi-v2-subtitle">通電率分析（時間帯・曜日別）</h4>
      <div class="kpi-v2-filters grid grid-cols-1 md:grid-cols-3 gap-4 mb-3">
        <!-- 左：表示期間 -->
        <div class="flex flex-col gap-1">
          <span class="kpi-v2-filter-label">表示期間（ヒートマップ）</span>
          <div class="flex flex-wrap items-center gap-2">
            <div id="teleapoHeatmapRangeButtons" class="flex flex-wrap gap-1">
              <button type="button" class="kpi-v2-range-btn kpi-v2-range-btn-active" data-heatmap-range="1w">
                過去1週間
              </button>
              <button type="button" class="kpi-v2-range-btn" data-heatmap-range="1m">
                過去1か月
              </button>
              <button type="button" class="kpi-v2-range-btn" data-heatmap-range="6m">
                過去半年
              </button>
            </div>
            <p id="teleapoHeatmapPeriodLabel" class="text-[11px] text-slate-500"></p>
          </div>
        </div>

        <!-- 中：担当者 -->
        <div class="kpi-v2-filter-group">
          <span class="kpi-v2-filter-label">担当者</span>
          <select id="teleapoHeatmapEmployeeFilter" class="kpi-v2-filter-select">
            <option value="all">全体</option>
            <option value="佐藤">佐藤</option>
            <option value="田中">田中</option>
            <option value="山本">山本</option>
            <option value="鈴木">鈴木</option>
          </select>
        </div>

        <!-- 右カラムは空き（レイアウト用） -->
        <div></div>
      </div>


      <div class="overflow-auto rounded-lg border border-slate-200 bg-white teleapo-heatmap-wrapper">
        <table class="min-w-[640px] border-collapse text-sm text-slate-700" id="teleapoHeatmapTable">
          <thead class="bg-slate-50">
            <tr>
              <th class="px-3 py-2 border border-slate-200 text-left">時間帯＼曜日</th>
              <th class="px-3 py-2 border border-slate-200 text-center">月</th>
              <th class="px-3 py-2 border border-slate-200 text-center">火</th>
              <th class="px-3 py-2 border border-slate-200 text-center">水</th>
              <th class="px-3 py-2 border border-slate-200 text-center">木</th>
              <th class="px-3 py-2 border border-slate-200 text-center">金</th>
            </tr>
          </thead>
          <tbody id="teleapoHeatmapTableBody">
            <!-- JSで生成 -->
          </tbody>
        </table>
      </div>

      <p id="teleapoHeatmapSelectionLabel" class="mt-2 text-[11px] text-slate-500">
        ※セルをクリックすると、その曜日・時間帯のログだけを下のテーブルに表示します（もう一度クリックで解除）。
      </p>
    </div>
  </div>

  <!-- 架電ログ（新規登録＋一覧） -->
  <div class="section-shell space-y-4">
    <div class="flex items-center justify-between">
      <h3 class="text-lg font-semibold text-slate-800 whitespace-nowrap">
        新規アポ管理（架電ログ）
      </h3>
      <div class="flex items-center gap-2">
        <input type="date" id="teleapoLogRangeStart"
          class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" />
        <span class="text-slate-500">〜</span>
        <input type="date" id="teleapoLogRangeEnd"
          class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" />
      </div>
    </div>

    <!-- 新規架電ログ入力フォーム -->
    <div class="border border-slate-200 rounded-lg p-4 bg-white space-y-3" id="teleapoSectionLogForm">
      <h4 class="text-sm font-semibold text-slate-700">新規架電ログ追加</h4>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3 text-xs">
        <div class="flex flex-col gap-1">
          <label class="text-xs font-semibold text-slate-500">日時</label>
          <input type="datetime-local" id="teleapoLogInputDatetime"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" />
        </div>
        <div class="flex flex-col gap-1">
          <label class="text-xs font-semibold text-slate-500">担当者</label>
          <select id="teleapoLogInputEmployee" class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm">
            <option value="">選択してください</option>
            <option value="佐藤">佐藤</option>
            <option value="田中">田中</option>
            <option value="山本">山本</option>
            <option value="鈴木">鈴木</option>
          </select>
        </div>
        <div class="flex flex-col gap-1">
          <label class="text-xs font-semibold text-slate-500">経路</label>
          <select id="teleapoLogInputRoute" class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm">
            <option value="tel">電話（通電ルート）</option>
            <option value="other">その他（メール・広告など）</option>
          </select>
        </div>
        <div class="flex flex-col gap-1">
          <label class="text-xs font-semibold text-slate-500">アポ結果</label>
          <select id="teleapoLogInputResult" class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm">
            <option value="">選択してください</option>
            <option value="通電">通電</option>
            <option value="不在">不在</option>
            <option value="設定">設定</option>
            <option value="着座">着座</option>
            <option value="コールバック">コールバック</option>
          </select>
        </div>
        <div class="flex flex-col gap-1">
          <label class="text-xs font-semibold text-slate-500">相手</label>
          <input type="text" id="teleapoLogInputTarget"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="企業名・担当者名など" />
        </div>
        <div class="flex flex-col gap-1">
          <label class="text-xs font-semibold text-slate-500">電話番号</label>
          <input type="text" id="teleapoLogInputTel"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" />
        </div>
        <div class="flex flex-col gap-1">
          <label class="text-xs font-semibold text-slate-500">メールアドレス</label>
          <input type="email" id="teleapoLogInputEmail"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" />
        </div>
        <div class="md:col-span-3 flex flex-col gap-1">
          <label class="text-xs font-semibold text-slate-500">メモ</label>
          <textarea id="teleapoLogInputMemo" rows="2"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm"></textarea>
        </div>
      </div>

      <p id="teleapoLogInputStatus" class="text-xs mt-1 text-slate-500"></p>

      <div class="flex justify-end">
        <button type="button" id="teleapoLogInputAddBtn"
          class="px-4 py-2 bg-indigo-600 text-white rounded-md text-sm hover:bg-indigo-700">
          この内容で追加
        </button>
      </div>
    </div>

    <!-- フィルタと検索 -->
    <div class="border border-slate-200 rounded-lg p-4 bg-slate-50 space-y-3" id="teleapoSectionLogs">
      <h4 class="text-sm font-semibold text-slate-700">架電ログ</h4>
      <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 text-xs text-slate-500">
        <div class="flex flex-col gap-1">
          <label class="text-xs font-semibold text-slate-500">担当者</label>
          <select id="teleapoLogEmployeeFilter" class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm">
            <option value="">全員</option>
            <option value="佐藤">佐藤</option>
            <option value="田中">田中</option>
            <option value="山本">山本</option>
            <option value="鈴木">鈴木</option>
          </select>
        </div>
        <div class="flex flex-col gap-1">
          <label class="text-xs font-semibold text-slate-500">アポ結果</label>
          <select id="teleapoLogResultFilter" class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm">
            <option value="">全て</option>
            <option value="通電">通電</option>
            <option value="不在">不在</option>
            <option value="設定">設定</option>
            <option value="着座">着座</option>
            <option value="コールバック">コールバック</option>
          </select>
        </div>
        <div class="flex flex-col gap-1">
          <label class="text-xs font-semibold text-slate-500">相手名検索</label>
          <input type="text" id="teleapoLogTargetSearch"
            class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="相手名で検索..." />
        </div>
        <div class="flex items-end gap-2">
          <button id="teleapoLogFilterReset"
            class="px-3 py-2 border border-slate-300 rounded-md text-sm hover:bg-slate-100 whitespace-nowrap">
            条件をクリア
          </button>
          <div id="teleapoLogFilterCount" class="px-2 py-1 bg-indigo-100 text-indigo-700 rounded text-xs font-semibold">
            0件
          </div>
        </div>
      </div>
    </div>

    <!-- ログテーブル -->
    <div class="overflow-auto rounded-lg border border-slate-200 bg-white">
      <table class="table-grid min-w-[1200px]" id="teleapoLogTable">
        <thead>
          <tr>
            <th class="cursor-pointer hover:bg-slate-100 sortable" data-sort="datetime">
              日時
              <span class="ml-1 text-xs text-slate-400">↕</span>
            </th>
            <th class="cursor-pointer hover:bg-slate-100 sortable" data-sort="employee">
              担当者
            </th>
            <th class="cursor-pointer hover:bg-slate-100 sortable" data-sort="route">
              経路
            </th>
            <th class="cursor-pointer hover:bg-slate-100 sortable" data-sort="target">
              相手
            </th>
            <th>電話番号</th>
            <th>メールアドレス</th>
            <th class="cursor-pointer hover:bg-slate-100 sortable" data-sort="result">
              アポ結果
            </th>
            <th>メモ</th>
          </tr>
        </thead>
        <tbody id="teleapoLogTableBody">
          <!-- JSで描画 -->
        </tbody>
      </table>
    </div>
  </div>

  <script type="module" src="./teleapo.js"></script>
</section>