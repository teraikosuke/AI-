<!-- 架電管理ページ | SmartHR/HRMOS Style Redesign with Tabs -->
<style>
  /* ===== Teleapo Page - Base Reset ===== */
  #teleapoPage .kpi-v2-section {
    box-shadow: none !important;
    border: none !important;
    background: transparent !important;
  }

  #teleapoPage {
    background: #f8fafc;
    /* 背景を薄いグレーに */
    padding: 24px;
    border-radius: 0;
  }

  /* ===== Header Bar (統一スタイル) ===== */
  .teleapo-header-bar {
    background: #ffffff;
    padding: 20px 24px;
    color: #1e293b;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-radius: 8px;
    margin-bottom: 24px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  }

  .teleapo-header-bar h3 {
    font-size: 18px;
    font-weight: 600;
    margin: 0;
  }

  .teleapo-header-bar p {
    font-size: 13px;
    opacity: 0.85;
    margin: 4px 0 0 0;
  }

  /* ===== Tab Navigation ===== */
  .teleapo-tabs {
    display: flex;
    gap: 0;
    background: transparent;
    border-radius: 0;
    margin-bottom: 0;
    border-bottom: 1px solid #e2e8f0;
    padding-bottom: 1px;
  }

  .teleapo-tab {
    flex: 1;
    padding: 16px 24px;
    font-size: 15px;
    font-weight: 600;
    color: #64748b;
    background: transparent;
    border: none;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    text-align: center;
  }

  .teleapo-tab:hover {
    color: #0077c7;
    background: #f8fafc;
  }

  .teleapo-tab.active {
    color: #0077c7;
    background: #ffffff;
  }

  .teleapo-tab.active::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0;
    right: 0;
    height: 3px;
    background: #0077c7;
    border-radius: 3px 3px 0 0;
  }

  .teleapo-tab-icon {
    display: none;
    /* 絵文字アイコン非表示 */
    margin-right: 8px;
    vertical-align: middle;
  }

  /* ===== Tab Panels ===== */
  .teleapo-panel {
    display: none;
    padding: 0;
    background: transparent;
    border-radius: 0;
  }

  .teleapo-panel.active {
    display: block;
  }

  /* ===== Section Cards ===== */
  .teleapo-section {
    background: #ffffff;
    border-radius: 8px;
    /* 角丸8px */
    padding: 32px;
    /* 余白拡大 */
    margin-bottom: 32px;
    /* セクション間隔拡大 */
    border: none;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    /* 非常に薄い影 */
  }

  .teleapo-section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 1px solid #e5e7eb;
    /* 見出し下線 */
    flex-wrap: wrap;
    gap: 12px;
  }

  .teleapo-section-title {
    font-size: 17px;
    font-weight: 600;
    color: #1e293b;
  }

  .teleapo-section-subtitle {
    font-size: 13px;
    color: #64748b;
    margin-top: 4px;
  }

  /* ===== KPI Cards (Redesigned) ===== */
  .teleapo-kpi-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 20px;
  }

  @media (max-width: 1024px) {
    .teleapo-kpi-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  .teleapo-kpi-card {
    background: #ffffff;
    border-radius: 8px;
    /* 角丸8px */
    padding: 24px;
    text-align: center;
    border: 1px solid #e5e7eb;
    /* 薄い枠線 */
  }

  .teleapo-kpi-label {
    font-size: 13px;
    font-weight: 500;
    color: #64748b;
    margin-bottom: 8px;
  }

  .teleapo-kpi-value {
    font-size: 32px;
    font-weight: 700;
    line-height: 1.1;
  }

  .teleapo-kpi-breakdown {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-top: 12px;
    font-size: 12px;
    color: #64748b;
  }

  .teleapo-kpi-breakdown-item {
    display: flex;
    justify-content: space-between;
    padding: 4px 8px;
    background: #f8fafc;
    border-radius: 6px;
  }

  .teleapo-kpi-breakdown-value {
    font-weight: 600;
    color: #334155;
  }

  /* ===== Filter Bar ===== */
  .teleapo-filter-bar {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 16px;
    padding: 16px 20px;
    background: transparent;
    border-radius: 0;
    margin-bottom: 0;
    border: none;
  }

  .teleapo-filter-group {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .teleapo-filter-label {
    font-size: 13px;
    font-weight: 500;
    color: #64748b;
  }

  .teleapo-filter-input {
    padding: 10px 14px;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    background: #f1f5f9;
    color: #334155;
  }

  .teleapo-filter-input:focus {
    outline: none;
    background: #e2e8f0;
  }

  .teleapo-filter-btn {
    padding: 10px 18px;
    border: none;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 500;
    background: #f1f5f9;
    color: #475569;
    cursor: pointer;
    transition: all 0.15s;
  }

  .teleapo-filter-btn:hover {
    background: #e2e8f0;
  }

  .teleapo-filter-btn.active {
    background: #0077c7;
    color: white;
  }

  /* ===== Tables ===== */
  .teleapo-table-wrapper {
    overflow-x: auto;
    border-radius: 10px;
    background: #ffffff;
  }

  .teleapo-table {
    width: 100%;
    border-collapse: collapse;
  }

  .teleapo-table th {
    padding: 12px 16px;
    background: #ffffff;
    /* 白背景 */
    font-size: 13px;
    font-weight: 600;
    color: #475569;
    text-align: left;
    white-space: nowrap;
    border-bottom: 2px solid #e2e8f0;
    /* ヘッダー下2px */
  }

  .teleapo-table td {
    padding: 16px 16px;
    font-size: 14px;
    color: #334155;
    border-bottom: 1px solid #e5e7eb;
    /* 横線のみ (top -> bottomに変更) */
    border-top: none;
  }

  .teleapo-table tbody tr:hover {
    background: #f8fafc;
  }

  /* ===== Chart Cards ===== */
  .teleapo-chart-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
  }

  @media (max-width: 1024px) {
    .teleapo-chart-grid {
      grid-template-columns: 1fr;
    }
  }

  .teleapo-chart-card {
    background: #ffffff;
    border-radius: 8px;
    padding: 24px;
    border: 1px solid #e5e7eb;
  }

  .teleapo-chart-title {
    font-size: 15px;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 4px;
  }

  .teleapo-chart-subtitle {
    font-size: 12px;
    color: #94a3b8;
    margin-bottom: 16px;
  }

  /* ===== Form Styles ===== */
  .teleapo-form-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
  }

  @media (max-width: 1024px) {
    .teleapo-form-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  .teleapo-form-field {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .teleapo-form-field label {
    font-size: 13px;
    font-weight: 500;
    color: #475569;
  }

  .teleapo-form-field input,
  .teleapo-form-field select,
  .teleapo-form-field textarea {
    padding: 10px 14px;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    font-size: 14px;
    background: #ffffff;
    transition: border-color 0.15s;
  }

  .teleapo-form-field input:focus,
  .teleapo-form-field select:focus,
  .teleapo-form-field textarea:focus {
    outline: none;
    border-color: #0077c7;
  }

  .teleapo-form-full {
    grid-column: 1 / -1;
  }

  .teleapo-form-actions {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid #f1f5f9;
  }

  .teleapo-form-hint {
    font-size: 12px;
    color: #94a3b8;
  }

  .teleapo-form-submit {
    padding: 12px 32px;
    background: #0077c7;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.15s;
  }

  .teleapo-form-submit:hover {
    background: #0066b0;
  }

  /* ===== Collapsible Sections ===== */
  .teleapo-collapsible {
    background: #ffffff;
    border-radius: 12px;
    margin-bottom: 16px;
    overflow: hidden;
  }

  .teleapo-collapsible-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 24px;
    cursor: pointer;
    transition: background 0.15s;
  }

  .teleapo-collapsible-header>div:first-child {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .teleapo-collapsible-header:hover {
    background: #f8fafc;
  }

  .teleapo-collapsible-title {
    font-size: 15px;
    font-weight: 600;
    color: #1e293b;
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
  }

  .teleapo-collapsible-subtitle {
    font-size: 12px;
    color: #64748b;
    margin-top: 2px;
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
  }

  .teleapo-collapsible-toggle {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .teleapo-collapsible-count {
    padding: 4px 12px;
    background: #0077c7;
    color: white;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    display: inline-flex !important;
    align-items: center;
    visibility: visible !important;
    opacity: 1 !important;
  }

  .teleapo-collapsible-btn {
    padding: 8px 16px;
    background: #f1f5f9;
    color: #475569;
    border: none;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
  }

  .teleapo-collapsible-content {
    display: none;
    padding: 0 24px 24px;
  }

  .teleapo-collapsible.open .teleapo-collapsible-content {
    display: block;
  }

  /* ===== Insight Card ===== */
  .teleapo-insight {
    background: linear-gradient(135deg, #eff6ff 0%, #ffffff 100%);
    border-left: 4px solid #0077c7;
    border-radius: 8px;
    padding: 16px 20px;
    margin-top: 20px;
  }

  .teleapo-insight-title {
    font-size: 13px;
    font-weight: 600;
    color: #0077c7;
    margin-bottom: 8px;
  }

  .teleapo-insight-text {
    font-size: 14px;
    color: #475569;
    line-height: 1.6;
  }

</style>

<section data-page="teleapo" id="teleapoPage" class="kpi-v2-wrapper">

  <!-- タブナビゲーション -->
  <div class="teleapo-tabs">
    <button class="teleapo-tab active" data-tab="performance">
      <span class="teleapo-tab-icon">📊</span>架電成績
    </button>
    <button class="teleapo-tab" data-tab="management">
      <span class="teleapo-tab-icon">📋</span>架電管理
    </button>
  </div>

  <!-- ========== 架電成績タブ ========== -->
  <div class="teleapo-panel active" id="teleapoPerformancePanel" data-panel="performance">

    <!-- 期間フィルター -->
    <div class="teleapo-filter-bar">
      <div class="teleapo-filter-group">
        <span class="teleapo-filter-label">期間</span>
        <input type="date" id="teleapoCompanyRangeStart" class="teleapo-filter-input" />
        <span style="color: #94a3b8;">〜</span>
        <input type="date" id="teleapoCompanyRangeEnd" class="teleapo-filter-input" />
      </div>
      <div class="teleapo-filter-group" style="margin-left: auto;">
        <button type="button" class="teleapo-filter-btn" data-preset="today">今日</button>
        <button type="button" class="teleapo-filter-btn" data-preset="thisWeek">今週</button>
        <button type="button" class="teleapo-filter-btn active" data-preset="thisMonth">今月</button>
      </div>
      <p id="teleapoCompanyPeriodLabel" class="text-xs text-slate-500"></p>
    </div>

    <!-- 全体KPI -->
    <div class="teleapo-section" id="teleapoSectionKpi">
      <div class="teleapo-section-header">
        <div>
          <h4 class="teleapo-section-title" id="teleapoSummaryTitle">全体KPI</h4>
          <p class="teleapo-section-subtitle">
            表示範囲: <span id="teleapoSummaryScopeLabel" class="font-semibold text-slate-700">全体</span>
            <button type="button" id="teleapoSummaryResetBtn" class="teleapo-filter-btn ml-2"
              style="padding: 4px 12px; font-size: 11px;">全体に戻る</button>
          </p>
        </div>
        <div class="teleapo-filter-group">
          <span class="teleapo-filter-label">着座率の分母</span>
          <div id="teleapoRateModeToggle" style="display: flex; gap: 4px;">
            <button type="button" data-rate-mode="contact" class="teleapo-filter-btn active">接触数</button>
            <button type="button" data-rate-mode="step" class="teleapo-filter-btn">設定数</button>
          </div>
        </div>
      </div>
      <p id="teleapoKpiCalcDesc" class="text-xs text-slate-500 mb-4">設定率=設定数/接触数・着座率=着座数/接触数</p>

      <!-- KPI率カード -->
      <div class="teleapo-kpi-grid" style="grid-template-columns: repeat(3, 1fr); margin-bottom: 16px;">
        <div class="teleapo-kpi-card">
          <div class="teleapo-kpi-label">接触率（全体）</div>
          <div class="teleapo-kpi-value" id="teleapoKpiContactRateTotal">-</div>
          <div class="teleapo-kpi-breakdown">
            <div class="teleapo-kpi-breakdown-item"><span>架電</span><span class="teleapo-kpi-breakdown-value"
                id="teleapoKpiContactRateTel">-</span></div>
            <div class="teleapo-kpi-breakdown-item"><span>その他</span><span class="teleapo-kpi-breakdown-value"
                id="teleapoKpiContactRateOther">-</span></div>
          </div>
        </div>
        <div class="teleapo-kpi-card">
          <div class="teleapo-kpi-label">設定率（全体）</div>
          <div class="teleapo-kpi-value" id="teleapoKpiSetRateTotal">-</div>
          <div class="teleapo-kpi-breakdown">
            <div class="teleapo-kpi-breakdown-item"><span>架電</span><span class="teleapo-kpi-breakdown-value"
                id="teleapoKpiSetRateTel">-</span></div>
            <div class="teleapo-kpi-breakdown-item"><span>その他</span><span class="teleapo-kpi-breakdown-value"
                id="teleapoKpiSetRateOther">-</span></div>
          </div>
        </div>
        <div class="teleapo-kpi-card">
          <div class="teleapo-kpi-label">着座率（全体）</div>
          <div class="teleapo-kpi-value" id="teleapoKpiShowRateTotal">-</div>
          <div class="teleapo-kpi-breakdown">
            <div class="teleapo-kpi-breakdown-item"><span>架電</span><span class="teleapo-kpi-breakdown-value"
                id="teleapoKpiShowRateTel">-</span></div>
            <div class="teleapo-kpi-breakdown-item"><span>その他</span><span class="teleapo-kpi-breakdown-value"
                id="teleapoKpiShowRateOther">-</span></div>
          </div>
        </div>
      </div>

      <!-- KPI件数カード -->
      <div class="teleapo-kpi-grid">
        <div class="teleapo-kpi-card">
          <div class="teleapo-kpi-label">架電数（架電ルート）</div>
          <div class="teleapo-kpi-value" id="teleapoKpiDialsTel">0</div>
          <p class="text-xs text-slate-500 mt-2">その他ルートには架電は含まれません</p>
        </div>
        <div class="teleapo-kpi-card">
          <div class="teleapo-kpi-label">接触数（全体）</div>
          <div class="teleapo-kpi-value" id="teleapoKpiContactsTotal">0</div>
          <div class="teleapo-kpi-breakdown">
            <div class="teleapo-kpi-breakdown-item"><span>架電</span><span class="teleapo-kpi-breakdown-value"
                id="teleapoKpiContactsTel">0</span></div>
            <div class="teleapo-kpi-breakdown-item"><span>その他</span><span class="teleapo-kpi-breakdown-value"
                id="teleapoKpiContactsOther">0</span></div>
          </div>
        </div>
        <div class="teleapo-kpi-card">
          <div class="teleapo-kpi-label">設定数（全体）</div>
          <div class="teleapo-kpi-value" id="teleapoKpiSetsTotal">0</div>
          <div class="teleapo-kpi-breakdown">
            <div class="teleapo-kpi-breakdown-item"><span>架電</span><span class="teleapo-kpi-breakdown-value"
                id="teleapoKpiSetsTel">0</span></div>
            <div class="teleapo-kpi-breakdown-item"><span>その他</span><span class="teleapo-kpi-breakdown-value"
                id="teleapoKpiSetsOther">0</span></div>
          </div>
        </div>
        <div class="teleapo-kpi-card">
          <div class="teleapo-kpi-label">着座数（全体）</div>
          <div class="teleapo-kpi-value" id="teleapoKpiShowsTotal">0</div>
          <div class="teleapo-kpi-breakdown">
            <div class="teleapo-kpi-breakdown-item"><span>架電</span><span class="teleapo-kpi-breakdown-value"
                id="teleapoKpiShowsTel">0</span></div>
            <div class="teleapo-kpi-breakdown-item"><span>その他</span><span class="teleapo-kpi-breakdown-value"
                id="teleapoKpiShowsOther">0</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- 社員成績 -->
    <div class="teleapo-section" id="teleapoSectionEmployees">
      <div class="teleapo-section-header">
        <div>
          <h4 class="teleapo-section-title">社員成績（架電ルートのみ）</h4>
          <p class="teleapo-section-subtitle">列名をクリックして並び替え</p>
        </div>
      </div>
      <div class="teleapo-table-wrapper" id="teleapoEmployeeTableWrapper">
        <table class="teleapo-table" id="teleapoEmployeeTable">
          <thead>
            <tr>
              <th data-sort="name" style="cursor: pointer;">社員</th>
              <th data-sort="dials" style="cursor: pointer;">架電数</th>
              <th data-sort="connects" style="cursor: pointer;">通電数</th>
              <th data-sort="sets" style="cursor: pointer;">設定数</th>
              <th data-sort="shows" style="cursor: pointer;">着座数</th>
              <th data-sort="connectRate" style="cursor: pointer;">通電率</th>
              <th data-sort="setRate" style="cursor: pointer;">設定率</th>
              <th data-sort="showRate" style="cursor: pointer;">着座率</th>
            </tr>
          </thead>
          <tbody id="teleapoEmployeeTableBody"></tbody>
        </table>
      </div>

      <!-- 社員チャート（選択時に表示） -->
      <div id="teleapoEmployeeChartWrapper" class="hidden" style="margin-top: 24px;">
        <div class="teleapo-chart-card">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <div>
              <p id="teleapoEmployeeChartTitle" class="teleapo-chart-title">社員別 成長KPI</p>
              <p class="teleapo-chart-subtitle">通電率・設定率・着座率の推移（架電ルートのみ）</p>
            </div>
            <div id="teleapoEmployeeTrendMode" style="display: flex; gap: 4px;">
              <button type="button" class="teleapo-filter-btn" data-employee-trend-mode="week">週</button>
              <button type="button" class="teleapo-filter-btn active" data-employee-trend-mode="month">月</button>
              <button type="button" class="teleapo-filter-btn" data-employee-trend-mode="year">年</button>
            </div>
          </div>
          <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
            <div style="height: 320px;">
              <svg id="teleapoEmployeeTrendChart" viewBox="0 0 800 320" style="width: 100%; height: 100%;"></svg>
            </div>
            <div>
              <p style="font-size: 13px; font-weight: 600; color: #64748b; margin-bottom: 8px;">期間別KPI <span
                  id="teleapoEmployeeTrendModeLabel">-</span></p>
              <div style="max-height: 220px; overflow-y: auto;">
                <table class="teleapo-table" style="font-size: 12px;">
                  <thead>
                    <tr>
                      <th>期間</th>
                      <th style="text-align: right;">架電数</th>
                      <th style="text-align: right;">通電率</th>
                      <th style="text-align: right;">設定率</th>
                      <th style="text-align: right;">着座率</th>
                    </tr>
                  </thead>
                  <tbody id="teleapoEmployeeTrendTableBody"></tbody>
                </table>
              </div>
            </div>
          </div>
          <div style="display: flex; gap: 20px; margin-top: 12px; font-size: 12px; color: #64748b;">
            <span style="border-bottom: 2px solid #3b82f6; padding-bottom: 2px;">通電率</span>
            <span style="border-bottom: 2px solid #22c55e; padding-bottom: 2px;">設定率</span>
            <span style="border-bottom: 2px solid #f97316; padding-bottom: 2px;">着座率</span>
          </div>
          <p id="teleapoEmployeeCalcDesc" class="text-xs text-slate-500 mt-2">通電率=通電数/架電数・設定率=設定数/通電数・着座率=着座数/通電数</p>
        </div>
      </div>
    </div>

    <!-- 通電率分析 -->
    <div class="teleapo-section" id="teleapoSectionHeatmap">
      <div class="teleapo-section-header">
        <div>
          <h4 class="teleapo-section-title">通電率分析</h4>
        </div>
        <div class="teleapo-filter-group">
          <span class="teleapo-filter-label">集計期間</span>
          <div id="teleapoAnalysisRangeButtons" style="display: flex; gap: 4px;">
            <button type="button" class="teleapo-filter-btn active" data-analysis-range="all">全期間</button>
            <button type="button" class="teleapo-filter-btn" data-analysis-range="1w">直近1週</button>
            <button type="button" class="teleapo-filter-btn" data-analysis-range="1m">直近1ヶ月</button>
            <button type="button" class="teleapo-filter-btn" data-analysis-range="6m">直近半年</button>
          </div>
          <span class="teleapo-filter-label" style="margin-left: 16px;">社員</span>
          <select id="teleapoAnalysisEmployeeFilter" class="teleapo-filter-input">
            <option value="all">全員</option>
            <option value="佐藤">佐藤</option>
            <option value="鈴木">鈴木</option>
            <option value="高橋">高橋</option>
            <option value="田中">田中</option>
          </select>
        </div>
      </div>
      <p id="teleapoAnalysisPeriodLabel" class="text-xs text-slate-500 mb-4"></p>

      <div class="teleapo-chart-grid">
        <div class="teleapo-chart-card" id="teleapoAttemptChartWrapper">
          <p class="teleapo-chart-title">架電回数と通電率</p>
          <p class="teleapo-chart-subtitle">架電回数ごとの平均通電率（%）</p>
          <div style="height: 300px;">
            <svg id="teleapoAttemptChart" viewBox="0 0 800 300" style="width: 100%; height: 100%;"></svg>
          </div>
          <p class="text-xs text-slate-500 mt-2">横軸: 架電回数 / 縦軸: 通電率（%）</p>
          <p id="teleapoAttemptChartNote" class="text-xs text-slate-500"></p>
        </div>
        <div class="teleapo-chart-card">
          <p class="teleapo-chart-title">通電率ヒートマップ</p>
          <p class="teleapo-chart-subtitle">曜日×時間帯の通電率分布（%）</p>
          <div class="teleapo-table-wrapper" style="max-height: 280px; overflow: auto;">
            <table class="teleapo-table" id="teleapoHeatmapTable" style="font-size: 12px;">
              <thead>
                <tr>
                  <th>曜日＼時間帯</th>
                  <th style="text-align: center;">月</th>
                  <th style="text-align: center;">火</th>
                  <th style="text-align: center;">水</th>
                  <th style="text-align: center;">木</th>
                  <th style="text-align: center;">金</th>
                </tr>
              </thead>
              <tbody id="teleapoHeatmapTableBody"></tbody>
            </table>
          </div>
          <p class="text-xs text-slate-500 mt-2">セル内の数値は通電率（%）。色が濃いほど高い時間帯です。</p>
        </div>
      </div>

      <div class="teleapo-insight">
        <div class="teleapo-insight-title">一言分析</div>
        <p id="teleapoInsightText" class="teleapo-insight-text">-</p>
      </div>
    </div>
  </div>

  <!-- ========== 架電管理タブ ========== -->
  <div class="teleapo-panel" id="teleapoManagementPanel" data-panel="management">

    <!-- 架電ログ入力 -->
    <div class="teleapo-section" id="teleapoFormSection">
      <div class="teleapo-section-header">
        <div>
          <h4 class="teleapo-section-title">架電ログ入力</h4>
          <p class="teleapo-section-subtitle">新規架電ログを登録</p>
        </div>
      </div>
      <div class="teleapo-form-grid">
        <div class="teleapo-form-field">
          <label>日時</label>
          <input id="dialFormCalledAt" type="datetime-local" required />
        </div>
        <div class="teleapo-form-field">
          <label>担当者</label>
          <select id="dialFormEmployee" required></select>
        </div>
        <div class="teleapo-form-field">
          <label>候補者名</label>
          <input id="dialFormCandidateName" list="dialFormCandidateList" type="text" required placeholder="候補者名を入力" />
          <datalist id="dialFormCandidateList"></datalist>
        </div>
        <div class="teleapo-form-field">
          <label>経路</label>
          <select id="dialFormRoute" required>
            <option value="電話">電話</option>
            <option value="SMS">SMS</option>
            <option value="その他">その他</option>
          </select>
        </div>
        <div class="teleapo-form-field">
          <label>架電回数</label>
          <input id="dialFormCallNo" type="number" min="1" max="10" required placeholder="1～10" />
        </div>
        <div class="teleapo-form-field">
          <label>アポ結果</label>
          <select id="dialFormResult" required>
            <option value="通電">通電</option>
            <option value="不在">不在</option>
            <option value="NG">NG</option>
            <option value="設定">設定</option>
            <option value="SMS送信">SMS送信</option>
          </select>
        </div>
        <div class="teleapo-form-field hidden" id="dialFormInterviewField">
          <label>初回面談日時</label>
          <input id="dialFormInterviewAt" type="datetime-local" />
        </div>
        <div class="teleapo-form-field teleapo-form-full">
          <label>メモ</label>
          <textarea id="dialFormMemo" rows="2" placeholder="メモを入力"></textarea>
        </div>
      </div>
      <input type="hidden" id="dialFormCandidateId" />
      <div class="teleapo-form-actions">
        <div class="teleapo-form-hint">日時は自動入力、候補者名を選ぶと架電回数・経路を自動セットします</div>
        <button id="dialFormSubmit" type="button" class="teleapo-form-submit">保存</button>
      </div>
      <p id="dialFormMessage" class="text-sm mt-2"></p>
    </div>

    <!-- CSタスク管理（折りたたみ） -->
    <div class="teleapo-collapsible" id="teleapoCsTaskSection">
      <div class="teleapo-collapsible-header" id="teleapoCsTaskToggle">
        <div>
          <p class="teleapo-collapsible-title">CSタスク管理</p>
          <p class="teleapo-collapsible-subtitle">対応が必要な候補者（未接触かつ有効応募）</p>
        </div>
        <div class="teleapo-collapsible-toggle">
          <span id="teleapoCsTaskCount" class="teleapo-collapsible-count">0件</span>
          <span class="teleapo-collapsible-btn">一覧を開く</span>
        </div>
      </div>
      <div class="teleapo-collapsible-content" id="teleapoCsTaskTableWrapper">
        <div class="teleapo-table-wrapper">
          <table class="teleapo-table" id="teleapoCsTaskTable">
            <thead>
              <tr>
                <th>フェーズ</th>
                <th>有効応募</th>
                <th>求職者名</th>
                <th>登録日時</th>
                <th>電話番号</th>
                <th>連絡希望時間帯</th>
                <th>架電登録</th>
              </tr>
            </thead>
            <tbody id="teleapoCsTaskTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- 候補者情報不足一覧（折りたたみ） -->
    <div class="teleapo-collapsible" id="teleapoMissingInfoSection">
      <div class="teleapo-collapsible-header" id="teleapoMissingInfoToggle">
        <div>
          <p class="teleapo-collapsible-title">候補者情報不足一覧</p>
          <p class="teleapo-collapsible-subtitle">年齢または電話番号が未登録の候補者</p>
        </div>
        <div class="teleapo-collapsible-toggle">
          <span id="teleapoMissingInfoCount" class="teleapo-collapsible-count">0件</span>
          <span class="teleapo-collapsible-btn">一覧を開く</span>
        </div>
      </div>
      <div class="teleapo-collapsible-content" id="teleapoMissingInfoTableWrapper">
        <div class="teleapo-table-wrapper">
          <table class="teleapo-table" id="teleapoMissingInfoTable">
            <thead>
              <tr>
                <th>不足項目</th>
                <th>求職者名</th>
                <th>登録日時</th>
                <th>年齢</th>
                <th>電話番号</th>
              </tr>
            </thead>
            <tbody id="teleapoMissingInfoTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- 架電ログ一覧 -->
    <div class="teleapo-section" id="teleapoSectionLogs">
      <div class="teleapo-section-header">
        <div>
          <h4 class="teleapo-section-title">架電ログ一覧</h4>
        </div>
        <button id="teleapoLogToggle" type="button" class="teleapo-filter-btn">一覧を閉じる</button>
      </div>
      <div id="teleapoLogWrapper">
        <div class="teleapo-filter-bar" style="margin-bottom: 16px;">
          <div class="teleapo-filter-group">
            <span class="teleapo-filter-label">担当者</span>
            <select id="teleapoLogEmployeeFilter" class="teleapo-filter-input">
              <option value="">全員</option>
              <option value="佐藤">佐藤</option>
              <option value="田中">田中</option>
              <option value="山本">山本</option>
              <option value="鈴木">鈴木</option>
            </select>
          </div>
          <div class="teleapo-filter-group">
            <span class="teleapo-filter-label">アポ結果</span>
            <select id="teleapoLogResultFilter" class="teleapo-filter-input">
              <option value="">全て</option>
              <option value="通電">通電</option>
              <option value="不在">不在</option>
              <option value="設定">設定</option>
              <option value="着座">着座</option>
              <option value="コールバック">コールバック</option>
            </select>
          </div>
          <div class="teleapo-filter-group">
            <span class="teleapo-filter-label">経路</span>
            <select id="teleapoLogRouteFilter" class="teleapo-filter-input">
              <option value="">全て</option>
              <option value="tel">架電</option>
              <option value="other">その他</option>
            </select>
          </div>
          <div class="teleapo-filter-group">
            <span class="teleapo-filter-label">相手名</span>
            <input type="text" id="teleapoLogTargetSearch" class="teleapo-filter-input" placeholder="相手名で検索..." />
          </div>
          <div class="teleapo-filter-group" style="margin-left: auto;">
            <button id="teleapoLogFilterReset" class="teleapo-filter-btn">クリア</button>
            <span id="teleapoLogFilterCount" class="teleapo-collapsible-count">0件</span>
          </div>
        </div>
        <div class="teleapo-table-wrapper">
          <table class="teleapo-table" id="teleapoLogTable" style="min-width: 1200px;">
            <thead>
              <tr>
                <th data-sort="datetime" style="cursor: pointer;">日時</th>
                <th data-sort="employee" style="cursor: pointer;">担当者</th>
                <th data-sort="route" style="cursor: pointer;">経路</th>
                <th data-sort="target" style="cursor: pointer;">相手</th>
                <th>電話番号</th>
                <th>連絡希望時間帯</th>
                <th>メールアドレス</th>
                <th data-sort="result" style="cursor: pointer;">アポ結果</th>
                <th>メモ</th>
                <th>削除</th>
              </tr>
            </thead>
            <tbody id="teleapoLogTableBody"></tbody>
          </table>
        </div>
        <p id="teleapoLogPeriodLabel" class="text-xs text-slate-500 mt-2"></p>
        <p id="teleapoLogStatus" class="text-xs text-slate-500"></p>
      </div>
    </div>
  </div>

  <!-- 候補者モーダル（共通） -->
  <div class="teleapo-candidate-modal" id="teleapoCandidateModal" aria-hidden="true">
    <div class="teleapo-candidate-panel">
      <div class="teleapo-candidate-header">
        <div>
          <p class="teleapo-candidate-eyebrow">候補者クイック詳細</p>
          <h3 id="teleapoCandidateModalTitle" class="teleapo-candidate-title">候補者詳細</h3>
        </div>
        <button type="button" id="teleapoCandidateClose" class="teleapo-candidate-close" aria-label="閉じる">×</button>
      </div>
      <div id="teleapoCandidateDetailContent" class="teleapo-candidate-body">
        <p class="teleapo-candidate-muted">候補者を選択すると詳細が表示されます。</p>
      </div>
    </div>
  </div>

</section>

<script>
  // グローバル関数: タブ切り替え（onclick属性から呼び出し）
  function switchTeleapoTab(targetPanel, clickedTab) {
    const performancePanel = document.getElementById('teleapoPerformancePanel');
    const managementPanel = document.getElementById('teleapoManagementPanel');
    const tabs = document.querySelectorAll('.teleapo-tab');

    // タブのアクティブ状態を更新
    tabs.forEach(t => t.classList.remove('active'));
    clickedTab.classList.add('active');

    // パネルの表示を切り替え
    if (targetPanel === 'performance') {
      performancePanel.style.display = 'block';
      performancePanel.classList.add('active');
      managementPanel.style.display = 'none';
      managementPanel.classList.remove('active');
    } else if (targetPanel === 'management') {
      performancePanel.style.display = 'none';
      performancePanel.classList.remove('active');
      managementPanel.style.display = 'block';
      managementPanel.classList.add('active');
    }
  }

  // グローバル関数: 折りたたみセクションのトグル
  function toggleTeleapoCollapsible(header) {
    const parent = header.closest('.teleapo-collapsible');
    parent.classList.toggle('open');
    const btn = header.querySelector('.teleapo-collapsible-btn');
    if (parent.classList.contains('open')) {
      btn.textContent = '閉じる';
    } else {
      btn.textContent = '一覧を開く';
    }
  }

  // フィルターボタンのアクティブ状態切り替え（必要に応じて）
  (function () {
    function initFilters() {
      document.querySelectorAll('[data-preset], [data-analysis-range], [data-rate-mode], [data-employee-trend-mode]').forEach(btn => {
        btn.addEventListener('click', function () {
          const siblings = this.parentElement.querySelectorAll('button');
          siblings.forEach(s => s.classList.remove('active'));
          this.classList.add('active');
        });
      });
    }
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initFilters);
    } else {
      initFilters();
    }
    setTimeout(initFilters, 500);
  })();
</script>

<script type="module" src="./teleapo.js?v=20260321"></script>
