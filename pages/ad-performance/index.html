<!DOCTYPE html>
<div class="section-shell space-y-4">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script
    src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>

  <div class="flex flex-wrap items-center justify-between gap-4">
    <h3 class="text-lg font-semibold text-slate-800 whitespace-nowrap">広告管理</h3>
    <div class="flex items-center gap-4">
      <div class="flex items-center gap-2">
        <label for="adMediaFilter" class="text-sm text-slate-600 whitespace-nowrap">媒体名:</label>
        <input id="adMediaFilter" type="text" placeholder="媒体名で検索"
          class="w-48 px-3 py-2 border border-slate-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500" />
      </div>
      <div class="flex items-center gap-2">
        <label for="adStartDate" class="text-sm text-slate-600 whitespace-nowrap">開始:</label>
        <input id="adStartDate" type="month"
          class="px-3 py-2 border border-slate-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500" />
        <label for="adEndDate" class="text-sm text-slate-600 whitespace-nowrap">終了:</label>
        <input id="adEndDate" type="month"
          class="px-3 py-2 border border-slate-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500" />
        <button id="adDateClear"
          class="px-3 py-2 border border-slate-300 rounded-md text-sm hover:bg-slate-100 whitespace-nowrap">期間クリア</button>
      </div>
      <button id="adResetFilter"
        class="px-3 py-2 border border-slate-300 rounded-md text-sm hover:bg-slate-100 whitespace-nowrap">全体表示</button>
      <button id="exportAdManagement"
        class="px-3 py-2 border border-slate-300 rounded-md text-sm hover:bg-slate-100 whitespace-nowrap">CSVエクスポート</button>
    </div>
  </div>

  <div class="grid gap-4 lg:grid-cols-3">
    <div class="p-4 rounded-lg border border-slate-200 bg-white shadow-sm">
      <div class="text-sm text-slate-500">応募者数（合計）</div>
      <div id="adSummaryTotalApplications" class="text-2xl font-bold text-slate-800 mt-1">-</div>
      <div class="text-xs text-slate-500 mt-1">媒体ごとの応募数の合計</div>
    </div>
    <div class="p-4 rounded-lg border border-slate-200 bg-white shadow-sm">
      <div class="text-sm text-slate-500">有効応募者数（合計）</div>
      <div id="adSummaryTotalValid" class="text-2xl font-bold text-slate-800 mt-1">-</div>
      <div class="text-xs text-slate-500 mt-1">スクリーニングを通過した件数</div>
    </div>
    <div class="p-4 rounded-lg border border-slate-200 bg-white shadow-sm">
      <div class="text-sm text-slate-500">決定率</div>
      <div id="adSummaryDecisionRate" class="text-2xl font-bold text-slate-800 mt-1">-</div>
      <div class="text-xs text-slate-500 mt-1">応募者のうち入社した人の割合</div>
    </div>
  </div>

  <div class="grid gap-4 lg:grid-cols-2">
    <div class="p-4 rounded-lg border border-slate-200 bg-white shadow-sm">
      <div class="flex items-center justify-between">
        <h4 class="text-base font-semibold text-slate-800">媒体別応募/有効応募件数</h4>
        <span class="text-xs text-slate-500">有効応募 / 応募</span>
      </div>
      <div id="adChartApplications" class="mt-3 space-y-3"></div>
      <div id="adContractInfo" class="mt-4 p-3 rounded border border-slate-200 bg-slate-50">
        <div class="text-sm text-slate-500 mb-1">媒体契約情報</div>
        <div class="text-base text-slate-700">媒体を選択すると契約条件を表示します。</div>
      </div>
    </div>
    <div class="p-4 rounded-lg border border-slate-200 bg-white shadow-sm">
      <div class="flex items-center justify-between">
        <h4 class="text-base font-semibold text-slate-800" id="adMetricTitle">決定率（月別推移・媒体別）</h4>
        <div class="flex items-center gap-2 text-xs text-slate-500">
          <label for="adMetricSelect" class="whitespace-nowrap">指標:</label>
          <select id="adMetricSelect"
            class="border border-slate-300 rounded px-2 py-1 text-xs focus:ring-2 focus:ring-indigo-500">
            <option value="decisionRate">決定率</option>
            <option value="initialInterviewRate">初回面談設定率</option>
            <option value="retention30">定着率</option>
          </select>
          <span>媒体をクリックでフィルタ</span>
        </div>
      </div>
      <div id="adChartRefunds" class="mt-3 w-full h-[460px] flex justify-center items-center">
        <canvas id="adDecisionLine" class="w-full h-full"></canvas>
      </div>
      <div id="adMetricTable" class="mt-4 overflow-auto rounded border border-slate-200 bg-white"></div>
    </div>
  </div>

  <div class="flex items-center justify-between text-sm text-slate-600">
    <div id="adManagementInfo" class="text-slate-500">0件 0-0表示</div>
    <div class="flex items-center gap-2">
      <button id="adManagementPrevBtn"
        class="px-3 py-1 border border-slate-300 rounded hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed"
        disabled>前のページ</button>
      <span id="adManagementPageInfo" class="px-2">1 / 1</span>
      <button id="adManagementNextBtn"
        class="px-3 py-1 border border-slate-300 rounded hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed"
        disabled>次のページ</button>
    </div>
  </div>

  <div class="overflow-auto rounded-lg border border-slate-200">
    <table class="table-grid min-w-[1400px]" id="adTable">
      <thead>
        <tr>
          <th class="sticky top-0 left-0 bg-white z-40 whitespace-nowrap">媒体名</th>
          <th class="sortable cursor-pointer hover:bg-slate-100 whitespace-nowrap" data-sort="applications">応募者数 <span
              class="sort-indicator ml-1">▼</span></th>
          <th class="sortable cursor-pointer hover:bg-slate-100 whitespace-nowrap" data-sort="validApplications">有効応募者数
            <span class="sort-indicator ml-1">▼</span>
          </th>
          <th class="sortable cursor-pointer hover:bg-slate-100 whitespace-nowrap" data-sort="initialInterviews">初回面談設定数
            <span class="sort-indicator ml-1">▼</span>
          </th>
          <th class="sortable cursor-pointer hover:bg-slate-100 whitespace-nowrap" data-sort="initialInterviewRate">
            初回面談設定率 <span class="sort-indicator ml-1">▼</span></th>
          <th class="sortable cursor-pointer hover:bg-slate-100 whitespace-nowrap" data-sort="offers">内定数 <span
              class="sort-indicator ml-1">▼</span></th>
          <th class="sortable cursor-pointer hover:bg-slate-100 whitespace-nowrap" data-sort="offerRate">内定率 <span
              class="sort-indicator ml-1">▼</span></th>
          <th class="sortable cursor-pointer hover:bg-slate-100 whitespace-nowrap" data-sort="hired">入社数 <span
              class="sort-indicator ml-1">▼</span></th>
          <th class="sortable cursor-pointer hover:bg-slate-100 whitespace-nowrap" data-sort="hireRate">入社率 <span
              class="sort-indicator ml-1">▼</span></th>
          <th class="sortable cursor-pointer hover:bg-slate-100 whitespace-nowrap" data-sort="decisionRate">決定率 <span
              class="sort-indicator ml-1">▼</span></th>
          <th class="sortable cursor-pointer hover-bg-slate-100 whitespace-nowrap" data-sort="retention30">定着率（30日）
            <span class="sort-indicator ml-1">▼</span>
          </th>
          <th class="sortable cursor-pointer hover:bg-slate-100 whitespace-nowrap" data-sort="refund">返金額（税込） <span
              class="sort-indicator ml-1">▼</span></th>
          <th class="sortable cursor-pointer hover:bg-slate-100 whitespace-nowrap" data-sort="cost">
            契約費用 <span class="sort-indicator ml-1">▼</span>
          </th>
          <th class="sortable cursor-pointer hover:bg-slate-100 whitespace-nowrap" data-sort="totalCost">総費用（契約＋返金）
            <span class="sort-indicator ml-1">▼</span></th>

        </tr>
      </thead>
      <tbody id="adManagementTableBody">
        <tr>
          <td colspan="12" class="text-center text-slate-500 py-6">読み込み中...</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="flex items-center justify-between text-sm text-slate-600">
    <div class="text-slate-500">50件/ページ</div>
    <div class="flex items-center gap-2">
      <button id="adManagementPrevBtn2"
        class="px-3 py-1 border border-slate-300 rounded hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed"
        disabled>前のページ</button>
      <span id="adManagementPageInfo2" class="px-2">1 / 1</span>
      <button id="adManagementNextBtn2"
        class="px-3 py-1 border border-slate-300 rounded hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed"
        disabled>次のページ</button>
    </div>
  </div>
</div>