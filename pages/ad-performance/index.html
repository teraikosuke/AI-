<!-- 広告管理ページ | SmartHR/HRMOS Style v2 - ミニマルデザイン -->
<style>
  /* ===== Ad Performance Page - Global Reset ===== */
  #adPerformancePage .section-shell {
    box-shadow: none !important;
    border: none !important;
    background: transparent !important;
    padding: 0 !important;
  }

  #adPerformancePage {
    background: #f8fafc;
    padding: 24px;
    border-radius: 12px;
  }

  /* ===== Hero Section - SmartHR Blue ===== */
  .ad-hero {
    background: linear-gradient(135deg, #0077c7 0%, #00a0e9 100%);
    border-radius: 12px;
    padding: 24px 32px;
    color: white;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 20px;
    flex-wrap: wrap;
    margin-bottom: 24px;
  }

  .ad-hero-content h3 {
    font-size: 22px;
    font-weight: 700;
    margin: 0 0 6px 0;
  }

  .ad-hero-content p {
    font-size: 14px;
    opacity: 0.9;
    margin: 0;
  }

  .ad-hero-btn {
    padding: 10px 20px;
    background: rgba(255, 255, 255, 0.15);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .ad-hero-btn:hover {
    background: rgba(255, 255, 255, 0.25);
  }

  /* ===== Filter Bar - ミニマル ===== */
  .ad-filter-bar {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 20px;
    padding: 16px 20px;
    background: #ffffff;
    border-radius: 10px;
    margin-bottom: 24px;
  }

  .ad-filter-group {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .ad-filter-label {
    font-size: 13px;
    font-weight: 500;
    color: #64748b;
    white-space: nowrap;
  }

  .ad-filter-input {
    padding: 10px 14px;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    background: #f1f5f9;
    color: #334155;
    transition: all 0.15s;
  }

  .ad-filter-input:focus {
    outline: none;
    background: #e2e8f0;
  }

  .ad-filter-btn {
    padding: 10px 18px;
    border: none;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 500;
    background: #f1f5f9;
    color: #475569;
    cursor: pointer;
    transition: all 0.15s;
  }

  .ad-filter-btn:hover {
    background: #e2e8f0;
  }

  /* ===== KPI Cards - ボーダーなし、背景で区別 ===== */
  .ad-kpi-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 24px;
  }

  @media (max-width: 1024px) {
    .ad-kpi-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 640px) {
    .ad-kpi-grid {
      grid-template-columns: 1fr;
    }
  }

  .ad-kpi-card {
    background: #ffffff;
    border-radius: 12px;
    padding: 20px 24px;
    transition: transform 0.15s;
  }

  .ad-kpi-card:hover {
    transform: translateY(-2px);
  }

  .ad-kpi-label {
    font-size: 13px;
    font-weight: 500;
    color: #64748b;
    margin-bottom: 10px;
  }

  .ad-kpi-value {
    font-size: 32px;
    font-weight: 700;
    color: #0077c7;
    line-height: 1.1;
  }

  .ad-kpi-note {
    font-size: 12px;
    color: #94a3b8;
    margin-top: 8px;
  }

  /* ===== Chart Cards - クリーン ===== */
  .ad-chart-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    margin-bottom: 24px;
  }

  @media (max-width: 1200px) {
    .ad-chart-grid {
      grid-template-columns: 1fr;
    }
  }

  .ad-chart-card {
    background: #ffffff;
    border-radius: 12px;
    padding: 24px;
    overflow: hidden;
  }

  .ad-chart-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
  }

  .ad-chart-title {
    font-size: 16px;
    font-weight: 600;
    color: #1e293b;
  }

  .ad-chart-select {
    padding: 8px 12px;
    border: none;
    border-radius: 6px;
    font-size: 13px;
    background: #f1f5f9;
    color: #475569;
    cursor: pointer;
  }

  .ad-chart-container {
    position: relative;
    width: 100%;
    height: 320px;
  }

  /* ===== Metric Table inside Chart Card ===== */
  .ad-metric-table-wrapper {
    margin-top: 20px;
    max-height: 180px;
    overflow: auto;
  }

  .ad-metric-table-wrapper table {
    width: 100%;
    font-size: 12px;
    border-collapse: collapse;
  }

  .ad-metric-table-wrapper th,
  .ad-metric-table-wrapper td {
    padding: 8px 12px;
    text-align: left;
  }

  .ad-metric-table-wrapper th {
    background: #f8fafc;
    font-weight: 600;
    color: #64748b;
    position: sticky;
    top: 0;
  }

  .ad-metric-table-wrapper td {
    color: #475569;
    border-top: 1px solid #f1f5f9;
  }

  /* ===== Main Table Section ===== */
  .ad-table-section {
    background: #ffffff;
    border-radius: 12px;
    overflow: hidden;
  }

  .ad-table-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px 24px;
    background: #f8fafc;
  }

  .ad-table-title {
    font-size: 16px;
    font-weight: 600;
    color: #1e293b;
  }

  .ad-table-info {
    font-size: 13px;
    color: #64748b;
  }

  .ad-table-wrapper {
    overflow-x: auto;
    max-width: 100%;
  }

  .ad-table-wrapper table {
    width: 100%;
    min-width: 1600px;
    border-collapse: collapse;
  }

  .ad-table-wrapper th {
    padding: 12px 16px;
    background: #f8fafc;
    font-size: 12px;
    font-weight: 600;
    color: #64748b;
    text-align: left;
    white-space: nowrap;
    border-bottom: 1px solid #e2e8f0;
  }

  .ad-table-wrapper td {
    padding: 14px 16px;
    font-size: 13px;
    color: #334155;
    border-bottom: 1px solid #f1f5f9;
  }

  .ad-table-wrapper tbody tr:hover {
    background: #f8fafc;
  }

  .ad-table-wrapper th:first-child,
  .ad-table-wrapper td:first-child {
    position: sticky;
    left: 0;
    background: inherit;
    z-index: 10;
  }

  .ad-table-wrapper th:first-child {
    background: #f8fafc;
  }

  .ad-table-wrapper tbody tr:hover td:first-child {
    background: #f8fafc;
  }

  /* ===== Pagination ===== */
  .ad-pagination {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 24px;
    background: #f8fafc;
  }

  .ad-pagination-info {
    font-size: 13px;
    color: #64748b;
  }

  .ad-pagination-controls {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .ad-pagination-btn {
    padding: 8px 16px;
    border: none;
    border-radius: 6px;
    font-size: 13px;
    background: #ffffff;
    color: #475569;
    cursor: pointer;
    transition: all 0.15s;
  }

  .ad-pagination-btn:hover:not(:disabled) {
    background: #e2e8f0;
  }

  .ad-pagination-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .ad-pagination-page {
    font-size: 13px;
    color: #475569;
    padding: 0 12px;
  }

  /* ===== Contract Info Panel ===== */
  .ad-contract-panel {
    margin-top: 20px;
    padding: 16px 20px;
    background: linear-gradient(135deg, #eff6ff 0%, #ffffff 100%);
    border-left: 3px solid #0077c7;
    border-radius: 8px;
  }

  .ad-contract-title {
    font-size: 13px;
    font-weight: 600;
    color: #0077c7;
    margin-bottom: 6px;
  }

  .ad-contract-content {
    font-size: 14px;
    color: #475569;
  }

  /* ===== Pie Chart Section ===== */
  .ad-pie-section {
    margin-top: 24px;
    padding-top: 24px;
    border-top: 1px solid #f1f5f9;
  }

  .ad-pie-title {
    font-size: 14px;
    font-weight: 600;
    color: #64748b;
    text-align: center;
    margin-bottom: 16px;
  }

  .ad-pie-container {
    height: 220px;
    display: flex;
    justify-content: center;
  }
</style>

<div id="adPerformancePage" class="section-shell space-y-4 max-w-screen-2xl mx-auto w-full">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script
    src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>

  <!-- フィルターバー -->
  <div class="ad-filter-bar">
    <div class="ad-filter-group">
      <span class="ad-filter-label">媒体名</span>
      <select id="adMediaFilter" class="ad-filter-input" style="min-width: 160px;">
        <option value="">すべて</option>
      </select>
    </div>
    <div class="ad-filter-group">
      <span class="ad-filter-label">計算基準</span>
      <select id="adCalcModeSelect" class="ad-filter-input">
        <option value="base">有効応募数基準</option>
        <option value="step">段階別基準</option>
      </select>
    </div>
    <div class="ad-filter-group">
      <span class="ad-filter-label">期間</span>
      <input id="adStartDate" type="month" class="ad-filter-input" style="width: 140px;" />
      <span style="color: #94a3b8; font-size: 13px;">〜</span>
      <input id="adEndDate" type="month" class="ad-filter-input" style="width: 140px;" />
    </div>
    <div class="ad-filter-group" style="margin-left: auto;">
      <button id="adDateClear" class="ad-filter-btn">クリア</button>
      <button id="adResetFilter" class="ad-filter-btn">リセット</button>
      <button id="exportAdManagement" class="ad-filter-btn" style="background: #0077c7; color: white;">
        <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
          style="display: inline-block; vertical-align: middle; margin-right: 4px;">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3" />
        </svg>
        CSVエクスポート
      </button>
    </div>
  </div>

  <!-- KPIカード -->
  <div class="ad-kpi-grid">
    <div class="ad-kpi-card">
      <div class="ad-kpi-label">有効応募数（有効応募率）</div>
      <div id="adSummaryValidWithRate" class="ad-kpi-value">-</div>
      <div class="ad-kpi-note">応募全体に対する割合</div>
    </div>
    <div class="ad-kpi-card">
      <div class="ad-kpi-label">初回面談設定率</div>
      <div id="adSummaryInitialInterviewRate" class="ad-kpi-value">-</div>
      <div class="ad-kpi-note">有効応募に対する割合</div>
    </div>
    <div class="ad-kpi-card">
      <div class="ad-kpi-label">入社率</div>
      <div id="adSummaryHireRate" class="ad-kpi-value">-</div>
      <div id="adSummaryHireRateNote" class="ad-kpi-note">有効応募数に対する割合</div>
    </div>
    <div class="ad-kpi-card">
      <div class="ad-kpi-label">ROAS</div>
      <div id="adSummaryRoas" class="ad-kpi-value">-</div>
      <div class="ad-kpi-note">売上額 ÷ 契約費用</div>
    </div>
  </div>

  <!-- グラフエリア -->
  <div class="ad-chart-grid">
    <!-- 棒グラフ -->
    <div class="ad-chart-card">
      <div id="adMainBarChartSection">
        <div class="ad-chart-header">
          <h4 class="ad-chart-title">媒体別指標比較</h4>
          <select id="adGraphMetricSelect" class="ad-chart-select">
            <option value="initialInterviewRate">初回面談設定率</option>
            <option value="hireRate">入社率</option>
            <option value="retentionWarranty">定着率</option>
            <option value="roas" selected>ROAS</option>
          </select>
        </div>
        <div id="adMainBarChartContainer" class="ad-chart-container">
          <canvas id="adMainBarChartCanvas"></canvas>
        </div>
        <!-- 円グラフ -->
        <div id="adMainPieChartContainer" class="ad-pie-section hidden">
          <h5 class="ad-pie-title">媒体別ROAS構成比</h5>
          <div class="ad-pie-container">
            <canvas id="adMainPieChartCanvas"></canvas>
          </div>
        </div>
      </div>
      <!-- 契約情報パネル -->
      <div id="adContractInfo" class="ad-contract-panel hidden">
        <div class="ad-contract-title">媒体契約情報</div>
        <div class="ad-contract-content">媒体を選択すると契約条件を表示します。</div>
      </div>
    </div>

    <!-- 折れ線グラフ -->
    <div class="ad-chart-card">
      <div class="ad-chart-header">
        <h4 class="ad-chart-title" id="adMetricTitle">月別推移</h4>
        <div style="display: flex; align-items: center; gap: 12px;">
          <select id="adMetricSelect" class="ad-chart-select">
            <option value="initialInterviewRate">初回面談設定率</option>
            <option value="hireRate">入社率</option>
            <option value="retentionWarranty">定着率</option>
            <option value="roas">ROAS</option>
          </select>
        </div>
      </div>
      <div id="adChartRefunds" class="ad-chart-container" style="height: 350px;">
        <canvas id="adDecisionLine"></canvas>
      </div>
      <div id="adMetricTable" class="ad-metric-table-wrapper"></div>
    </div>
  </div>

  <!-- テーブルセクション -->
  <div class="ad-table-section">
    <div class="ad-table-header">
      <h4 class="ad-table-title">媒体パフォーマンス詳細</h4>
      <div id="adManagementInfo" class="ad-table-info">0件表示</div>
    </div>
    <div class="ad-table-wrapper">
      <table id="adTable">
        <thead>
          <tr>
            <th>媒体名</th>
            <th class="sortable" data-sort="applications">応募数</th>
            <th class="sortable" data-sort="validApplications">有効応募数</th>
            <th class="sortable" data-sort="validApplicationRate">有効応募率</th>
            <th class="sortable" data-sort="initialInterviews">初回面談数</th>
            <th class="sortable" data-sort="initialInterviewRate" id="headerNoteInitialInterviewRate">初回面談率</th>
            <th class="sortable" data-sort="offers">内定数</th>
            <th class="sortable" data-sort="offerRate" id="headerNoteOfferRate">内定率</th>
            <th class="sortable" data-sort="hired">入社数</th>
            <th class="sortable" data-sort="hireRate" id="headerNoteHireRate">入社率</th>
            <th class="sortable" data-sort="retentionWarranty">定着率</th>
            <th class="sortable" data-sort="totalSales">売上高</th>
            <th class="sortable" data-sort="cost">契約費用</th>
            <th class="sortable" data-sort="roas">ROAS</th>
            <th class="sortable" data-sort="refund">返金額</th>
          </tr>
        </thead>
        <tbody id="adManagementTableBody">
          <tr>
            <td colspan="15" style="text-align: center; padding: 40px; color: #94a3b8;">読み込み中...</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="ad-pagination">
      <div class="ad-pagination-info">
        <select class="ad-filter-input" style="padding: 6px 10px; font-size: 12px;">
          <option value="25">25件</option>
          <option value="50" selected>50件</option>
          <option value="100">100件</option>
        </select>
      </div>
      <div class="ad-pagination-controls">
        <button id="adManagementPrevBtn" class="ad-pagination-btn" disabled>前へ</button>
        <span id="adManagementPageInfo" class="ad-pagination-page">1 / 1</span>
        <button id="adManagementNextBtn" class="ad-pagination-btn" disabled>次へ</button>
      </div>
    </div>
  </div>
</div>