---
trigger: model_decision
description: 新しいルールの作成、ルールファイルの設計、エージェント制約の定義について言及された場合に適用する。
slug: meta-rule-creation
---
# ルール作成ガイドライン (Rule Creation Guidelines)

ユーザーの指示から `.agent/rules/` 配下のルールファイルを作成する際は、以下のガイドラインに従うこと。

## ルールの本質

ルールは **エージェントの「憲法」** である。永続的なコンテキスト境界と行動制約（何をすべきか、何をすべきでないか）を宣言的に定義する。

## ファイル構造

```markdown
---
trigger: <トリガータイプ>
description: <ルールの目的を1-2文で説明>
slug: <一意の識別子>
---
# <ルール名>

<ルールの本文>
```

## トリガータイプの選択基準

| トリガー | 選択条件 | 例 |
|----------|----------|-----|
| `always_on` | プロジェクト全体で常に適用すべき制約 | 技術スタック、セキュリティ要件、コーディング規約 |
| `model_decision` | 特定の意図・タスクに関連する制約 | リファクタリング時の注意点、レビュー基準 |
| `glob` | 特定のファイルパターンに適用する制約 | `**/*.tsx` → React固有ルール |
| `manual` | 明示的に呼び出す場合のみ適用 | 特殊なマイグレーション手順、監査用チェック |

## description の書き方

`model_decision` トリガーの場合、`description` はエージェントがルールを選択する判断材料となる。以下を含めること：

- **いつ適用するか**: 「〜について言及された場合」「〜を求められた場合」
- **キーワード**: 関連する動詞・名詞を含める

```yaml
# 良い例
description: コードのリファクタリング、技術的負債の解消、コード整理を求められた場合に適用する。

# 悪い例
description: リファクタリングのルール
```

## ルール本文の書き方

### 構造化する
- 見出し（##, ###）で論理的に分割
- 箇条書きで具体的な制約を列挙
- 優先順位がある場合は番号付きリストを使用

### 具体的に書く
```markdown
# 悪い例
- 型を適切に使うこと

# 良い例
- すべての関数シグネチャに型注釈を付与すること
- `any` 型の使用は禁止。やむを得ない場合は `unknown` を使用し、型ガードを実装すること
```

### 禁止事項は明確に
```markdown
## 禁止事項 (MUST NOT)
- APIキーやパスワードをコード内に直接記述してはならない
- `eval()` の使用は厳禁とする
```

### 例外条件も記載する
```markdown
- `any` 型は原則禁止。ただし、外部ライブラリの型定義が不完全な場合は、コメントで理由を明記した上で使用可。
```

## 命名規則

- ファイル名: `<カテゴリ>-<具体的な内容>.md` （ケバブケース）
- slug: ファイル名と同一（拡張子なし）

例:
- `security-mandates.md` → セキュリティ義務
- `react-components.md` → Reactコンポーネント規約
- `api-design.md` → API設計基準

## ルールの粒度

- **1ルール = 1関心事**: 複数の異なる関心事を1ファイルに混在させない
- **適度な長さ**: 500-1500文字程度を目安に。長すぎるとコンテキストを圧迫する
- **分割の判断**: 異なるトリガータイプが必要なら分割すべき

## 既存ルールとの整合性

新規ルール作成時は以下を確認すること：
1. 既存ルールと矛盾しないか
2. 重複する内容がないか
3. 参照（`@path/to/rule.md`）で再利用できないか
