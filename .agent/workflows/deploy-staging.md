---
description: ステージング環境へのデプロイを安全に実行する。
---
# ステージングデプロイ (Deploy Staging)

**再帰的合成**: このワークフローは他のワークフローを呼び出して構成される。

```
/deploy-staging
├── /verify-code（事前検証）
├── ビルド・デプロイ（このワークフロー固有）
└── 動作確認
```

---

## Step 1: 事前チェック // turbo
デプロイ前の確認を行え：
```bash
# 現在のブランチを確認
git branch --show-current

# 未コミットの変更がないか確認
git status
```

## Step 2: コード検証
コードの健全性を事前検証せよ：
- コマンド: `/verify-code`
- 失敗時: デプロイを中止し、問題を報告

## Step 3: ビルド検証 // turbo
プロダクションビルドが成功することを確認せよ：
```bash
pnpm build
```
ビルドエラーがある場合は、修正してから続行すること。

## Step 4: 環境変数の確認
ステージング環境に必要な環境変数が設定されているか確認せよ：
- 必須の環境変数一覧をユーザーに提示
- 不足している場合は警告

## Step 5: デプロイ実行
ユーザーの承認を得てからデプロイを実行せよ。
（自動実行しないこと - 本番に影響する可能性があるため）

## Step 6: 動作確認
デプロイ後の動作確認手順を提示せよ：
- ヘルスチェックエンドポイントの確認
- 主要機能の簡易テスト
- ログの監視ポイント

## Step 7: ロールバック手順の提示
問題発生時のロールバック手順を提示せよ：
```bash
# 直前のデプロイに戻す
git revert HEAD
# または特定のコミットに戻す
git checkout <commit-hash>
```

## Step 8: 完了報告
デプロイ結果をユーザーに報告せよ：
- デプロイ時刻
- デプロイされたコミットハッシュ
- ステージング環境のURL
- ロールバック方法
