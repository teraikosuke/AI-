---
trigger: always_on
slug: security-mandates
---
# セキュリティ義務 (Security Mandates)

すべてのコードは以下のセキュリティ基準を満たすこと。

## 禁止事項 (MUST NOT)

### シークレット管理
- APIキー、パスワード、トークンをコード内にハードコードしてはならない
- `.env` ファイルをGitにコミットしてはならない
- ログにセンシティブな情報を出力してはならない

### 危険な関数
- `eval()` の使用禁止
- `Function()` コンストラクタの使用禁止
- `innerHTML` への未サニタイズ入力の代入禁止

### データベース
- SQLの文字列結合によるクエリ構築禁止
- 必ずパラメータ化クエリまたはORMを使用すること

## 必須事項 (MUST)

### 入力検証
- すべてのユーザー入力をバリデーションすること
- 許可リスト方式でバリデーションすること（拒否リストではなく）

### 出力エンコーディング
- HTMLに出力する際は適切にエスケープすること
- JSONレスポンスは `Content-Type: application/json` を設定すること

### 認証・認可
- 認証が必要なエンドポイントには必ず認証ミドルウェアを適用すること
- 認可チェックは各リクエストで実行すること

### 依存関係
- 既知の脆弱性がある依存関係を使用しないこと
- 定期的に `npm audit` / `pnpm audit` を実行すること

## 環境変数の使用
```typescript
// ✅ 正しい例
const apiKey = process.env.API_KEY;

// ❌ 間違った例
const apiKey = "sk-1234567890abcdef";
```
