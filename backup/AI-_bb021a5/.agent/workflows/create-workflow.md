---
description: ユーザーの要求から新しいワークフローファイル（.agent/workflows/*.md）を対話的に作成する。
---
# ワークフロー作成 (Create Workflow)

## Step 1: タスクのヒアリング
ユーザーから以下の情報を収集せよ：

1. **何を達成したいか**: ワークフローのゴールは何か
2. **どんな手順で行うか**: 大まかなステップの流れ
3. **自動化したい部分**: エージェントに任せたい操作
4. **確認が必要な部分**: ユーザー承認が必要なポイント
5. **使用するツール**: ターミナルコマンド、ブラウザ操作など

情報が不足している場合は、具体的な質問で補完せよ。

## Step 2: ステップの分解
タスクを論理的なステップに分解せよ：

### 分解の基準
- **1ステップ = 1つの明確なアクション**
- **依存関係を考慮**: 前のステップの結果が必要か
- **並列実行可能か**: 独立したステップは並列化を検討

### ステップの種類
| 種類 | 内容 | 例 |
|------|------|-----|
| 分析 | 情報の収集・解析 | ファイル読み込み、コード解析 |
| 計画 | 方針の策定・提示 | テスト計画、リファクタリング案 |
| 実行 | 実際の操作 | コード生成、ファイル作成 |
| 検証 | 結果の確認 | テスト実行、動作確認 |
| 報告 | ユーザーへの通知 | 完了報告、エラー報告 |

分解したステップをユーザーに提示し、フィードバックを求めよ。

## Step 3: Turbo Mode の判定
各ステップについて `// turbo` の適用可否を判定せよ：

### Turbo適用可（ユーザー承認不要）
- 読み取り操作（`git status`, `ls`, `cat`）
- テスト実行（`pnpm test`, `pytest`）
- Lint/型チェック（`pnpm lint`, `tsc --noEmit`）
- ビルド（`pnpm build`）

### Turbo適用不可（ユーザー承認必要）
- ファイル削除
- Git push / merge / rebase
- デプロイ操作
- 外部APIへの書き込み
- 課金が発生する操作

判定結果をユーザーに提示し、調整が必要か確認せよ。

## Step 4: エラーハンドリングの設計
各ステップで起こりうるエラーと対処法を設計せよ：

```
ステップ: <ステップ名>
想定エラー:
  - <エラー1>: <対処法>
  - <エラー2>: <対処法>
最大リトライ: <回数>
リトライ後も失敗: <中断 or ユーザーに報告>
```

## Step 5: ワークフロー構造の設計
以下の構造でワークフローを設計せよ：

```markdown
---
description: <ワークフローの目的を簡潔に>
---
# <ワークフロー名>

## Step 1: <ステップ名>
<具体的な指示>

## Step 2: <ステップ名> // turbo
<具体的な指示>

**エラー時**: <対処法>
```

設計案をユーザーに提示し、フィードバックを求めよ。

## Step 6: ファイル名の決定
以下のルールに従ってファイル名を決定せよ：

- 形式: `<動詞>-<対象>.md`
- ケバブケース（小文字、ハイフン区切り）
- コマンドとして呼びやすい名前

例:
- `generate-api-docs.md` → `/generate-api-docs`
- `setup-database.md` → `/setup-database`
- `deploy-production.md` → `/deploy-production`

## Step 7: 既存ワークフローとの整合性チェック
`.agent/workflows/` 配下の既存ワークフローを確認せよ：

1. **重複チェック**: 同様の機能が既に存在しないか
2. **再利用可能性**: 既存ワークフローを呼び出して使えないか
3. **命名の一貫性**: 既存の命名規則と整合しているか

## Step 8: ワークフローファイルの生成
設計に基づいてワークフローファイルを作成せよ。

保存先: `ZG_PROJECT/<プロジェクト名>/.agent/workflows/<決定したファイル名>`

## Step 9: 検証
作成したワークフローの検証を行え：

1. **YAML構文チェック**: フロントマターが正しくパースできるか
2. **ステップの論理性**: 順序や依存関係が正しいか
3. **指示の明確さ**: エージェントが迷わず実行できるか
4. **Turboの適切さ**: 危険な操作にTurboが付いていないか

作成したワークフローの全文をユーザーに提示し、最終確認を求めよ。

## Step 10: 完了報告
以下の情報をユーザーに報告せよ：

- 作成したファイルのパス
- 呼び出しコマンド（`/<ファイル名>`）
- ワークフローの概要フロー図（テキスト形式）
- 関連するルールやワークフロー（あれば）
